<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0a0e14">
    <meta name="description" content="EnglishMaster LC - Interactive Irish Leaving Certificate English study app with flashcards, quizzes, literary terms, and more.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EnglishMaster LC">
    <title>EnglishMaster LC | Irish Leaving Cert English</title>
    <!-- Favicon & Icons -->
    <link rel="icon" type="image/svg+xml" href="icon.svg">
    <link rel="apple-touch-icon" href="icon-192.svg">
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0e14;
            --bg-secondary: #111820;
            --bg-tertiary: #1a2230;
            --glass: rgba(20, 30, 48, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-cyan: #8b5cf6;
            --accent-magenta: #ff006e;
            --accent-yellow: #ffbe0b;
            --accent-green: #a78bfa;
            --accent-purple: #7c3aed;
            --text-primary: #f0f4f8;
            --text-secondary: #8899a6;
            --text-muted: #5c6b7a;
            --success: #00ff88;
            --warning: #ffbe0b;
            --error: #ff006e;
            --radius: 16px;
            --radius-sm: 8px;
            --shadow-glow: 0 0 40px rgba(0, 212, 255, 0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { -webkit-tap-highlight-color: transparent; }
        button, .btn, .nav-btn, .quick-action, .answer-option, .quiz-option { touch-action: manipulation; -webkit-touch-callout: none; }
        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .bg-molecules {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }
        .molecule {
            position: absolute;
            border: 1px solid rgba(0, 212, 255, 0.1);
            border-radius: 50%;
            animation: float 20s infinite ease-in-out;
        }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.3; }
            25% { transform: translate(30px, -30px) rotate(90deg); opacity: 0.6; }
            50% { transform: translate(-20px, 20px) rotate(180deg); opacity: 0.3; }
            75% { transform: translate(20px, 40px) rotate(270deg); opacity: 0.5; }
        }
        .app-container { position: relative; z-index: 1; min-height: 100vh; display: flex; flex-direction: column; }
        .header {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem 1.5rem;
            position: sticky;
            top: 0; z-index: 100;
        }
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .logo { display: flex; align-items: center; gap: 0.75rem; }
        .logo-icon {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
        }
        .logo-text {
            font-weight: 700; font-size: 1.25rem;
            background: linear-gradient(135deg, var(--accent-cyan), var(--text-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .logo-sub { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .user-stats { display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; }
        .stat-pill {
            display: flex; align-items: center; gap: 0.5rem;
            background: var(--bg-tertiary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .stat-pill .value { font-weight: 600; color: var(--accent-cyan); }
        .nav-container {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--glass-border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-cyan) var(--bg-tertiary);
        }
        .nav-container::-webkit-scrollbar { height: 4px; }
        .nav-container::-webkit-scrollbar-track { background: var(--bg-tertiary); }
        .nav-container::-webkit-scrollbar-thumb { background: var(--accent-cyan); border-radius: 2px; }
        .nav {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 0.25rem;
            padding: 0.5rem;
        }
        .nav-btn {
            flex-shrink: 0;
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }
        .nav-btn:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .nav-btn.active { color: var(--accent-cyan); background: rgba(0, 212, 255, 0.1); }
        .main { flex: 1; max-width: 1400px; margin: 0 auto; padding: 1.5rem; width: 100%; }
        .section { display: none; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .section-header { margin-bottom: 1.5rem; }
        .section-title { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; }
        .section-subtitle { color: var(--text-secondary); font-size: 1rem; }
        .card {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .card:hover { border-color: rgba(0, 212, 255, 0.3); box-shadow: var(--shadow-glow); }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        .progress-ring { width: 120px; height: 120px; margin: 0 auto 1rem; }
        .progress-ring circle { fill: none; stroke-width: 8; }
        .progress-ring .bg { stroke: var(--bg-tertiary); }
        .progress-ring .progress {
            stroke: var(--accent-cyan);
            stroke-linecap: round;
            transform: rotate(-90deg);
            transform-origin: center;
            transition: stroke-dashoffset 0.5s ease;
        }
        .progress-text { text-anchor: middle; dominant-baseline: middle; font-size: 1.5rem; font-weight: 700; fill: var(--text-primary); }
        .quick-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .quick-action {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 1.5rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            color: inherit;
        }
        .quick-action:hover { background: rgba(0, 212, 255, 0.1); border-color: var(--accent-cyan); transform: translateY(-2px); }
        .quick-action .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .quick-action .label { font-weight: 500; font-size: 0.9rem; }
        .topic-card { cursor: pointer; position: relative; overflow: hidden; }
        .topic-card::before {
            content: '';
            position: absolute; top: 0; left: 0;
            width: 4px; height: 100%;
            background: var(--accent-cyan);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .topic-card:hover::before { opacity: 1; }
        .topic-header { display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 1rem; }
        .topic-icon {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem;
        }
        .topic-progress { font-size: 0.85rem; color: var(--accent-green); font-weight: 600; }
        .topic-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .topic-desc { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; }
        .topic-stats { display: flex; gap: 1rem; font-size: 0.8rem; color: var(--text-muted); }
        .periodic-container { overflow-x: auto; padding-bottom: 1rem; }
        .periodic-table { display: grid; grid-template-columns: repeat(18, minmax(42px, 1fr)); gap: 2px; min-width: 850px; }
        .element {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            border-radius: 4px;
            padding: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-size: 0.65rem;
            position: relative;
        }
        .element:hover { transform: scale(1.2); z-index: 10; box-shadow: 0 0 20px rgba(0, 212, 255, 0.4); }
        .element .number { font-size: 0.5rem; color: var(--text-muted); position: absolute; top: 1px; left: 3px; }
        .element .symbol { font-weight: 700; font-size: 0.9rem; font-family: 'Space Mono', monospace; }
        .element .name { font-size: 0.4rem; color: var(--text-secondary); text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%; }
        .element.alkali { background: rgba(255, 0, 110, 0.3); border-color: rgba(255, 0, 110, 0.5); }
        .element.alkaline { background: rgba(255, 190, 11, 0.3); border-color: rgba(255, 190, 11, 0.5); }
        .element.transition { background: rgba(0, 212, 255, 0.2); border-color: rgba(0, 212, 255, 0.4); }
        .element.post-transition { background: rgba(131, 56, 236, 0.3); border-color: rgba(131, 56, 236, 0.5); }
        .element.metalloid { background: rgba(0, 255, 136, 0.2); border-color: rgba(0, 255, 136, 0.4); }
        .element.nonmetal { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); }
        .element.halogen { background: rgba(0, 255, 200, 0.3); border-color: rgba(0, 255, 200, 0.5); }
        .element.noble { background: rgba(100, 100, 255, 0.3); border-color: rgba(100, 100, 255, 0.5); }
        .element-spacer { visibility: hidden; }
        .periodic-legend { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1rem; justify-content: center; }
        .legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.7rem; color: var(--text-secondary); }
        .legend-color { width: 14px; height: 14px; border-radius: 3px; }
        .modal-overlay {
            display: none;
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center; justify-content: center;
            padding: 1rem;
        }
        .modal-overlay.active { display: flex; }
        .modal {
            background: var(--bg-secondary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            max-width: 500px; width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalIn 0.3s ease;
        }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
            display: flex; align-items: center; justify-content: space-between;
        }
        .modal-close {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex; align-items: center; justify-content: center;
        }
        .modal-close:hover { background: var(--error); color: white; }
        .modal-body { padding: 1.5rem; }
        .element-detail-header { display: flex; align-items: center; gap: 1.5rem; }
        .element-big {
            width: 80px; height: 80px;
            border-radius: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .element-big .symbol { font-size: 2rem; font-weight: 700; font-family: 'Space Mono', monospace; }
        .element-big .number { font-size: 0.8rem; color: var(--text-secondary); }
        .element-info h2 { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .element-info p { color: var(--text-secondary); font-size: 0.9rem; }
        .element-properties { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-top: 1.5rem; }
        .property { background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); }
        .property-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.25rem; }
        .property-value { font-size: 1.1rem; font-weight: 600; color: var(--accent-cyan); }
        .flashcard-controls { display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }
        select, input[type="text"], input[type="number"] {
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            font-family: inherit;
            font-size: 0.9rem;
            min-width: 180px;
        }
        select:focus, input:focus { outline: none; border-color: var(--accent-cyan); }
        .flashcard-area { display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
        .flashcard { width: 100%; max-width: 600px; min-height: 280px; perspective: 1000px; cursor: pointer; }
        .flashcard-inner {
            position: relative; width: 100%; height: 280px;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: var(--radius);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 2rem;
            text-align: center;
        }
        .flashcard-front { background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary)); border: 1px solid var(--glass-border); }
        .flashcard-back {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(131, 56, 236, 0.1));
            border: 1px solid rgba(0, 212, 255, 0.3);
            transform: rotateY(180deg);
        }
        .flashcard-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 1rem; }
        .flashcard-content { font-size: 1.2rem; line-height: 1.6; }
        .flashcard-hint { font-size: 0.85rem; color: var(--text-muted); margin-top: auto; }
        .flashcard-nav { display: flex; align-items: center; gap: 1rem; }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            border: none;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-primary { background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4); }
        .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--glass-border); }
        .btn-secondary:hover { border-color: var(--accent-cyan); }
        .btn-icon { width: 44px; height: 44px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .card-counter { font-size: 0.9rem; color: var(--text-secondary); }
        .rating-buttons { display: flex; gap: 0.5rem; margin-top: 1rem; }
        .rating-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        .rating-btn.hard { background: rgba(255, 0, 110, 0.2); color: var(--error); border: 1px solid rgba(255, 0, 110, 0.3); }
        .rating-btn.good { background: rgba(255, 190, 11, 0.2); color: var(--warning); border: 1px solid rgba(255, 190, 11, 0.3); }
        .rating-btn.easy { background: rgba(0, 255, 136, 0.2); color: var(--success); border: 1px solid rgba(0, 255, 136, 0.3); }
        .rating-btn:hover { transform: translateY(-2px); }
        .quiz-setup { max-width: 600px; margin: 0 auto; }
        .quiz-options { display: grid; gap: 0.75rem; margin-bottom: 1.5rem; }
        .quiz-option {
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-sm);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-option:hover { border-color: var(--accent-cyan); }
        .quiz-option.selected { border-color: var(--accent-cyan); background: rgba(0, 212, 255, 0.1); }
        .quiz-area { max-width: 800px; margin: 0 auto; }
        .quiz-progress { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        .progress-bar { flex: 1; height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .quiz-question {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 2rem;
            margin-bottom: 1.5rem;
        }
        .question-number { font-size: 0.85rem; color: var(--accent-cyan); margin-bottom: 0.5rem; }
        .question-text { font-size: 1.15rem; line-height: 1.6; margin-bottom: 1.5rem; }
        .answers { display: grid; gap: 0.75rem; }
        .answer-option {
            background: var(--bg-tertiary);
            border: 2px solid var(--glass-border);
            border-radius: var(--radius-sm);
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .answer-option:hover:not(.disabled) { border-color: var(--accent-cyan); background: rgba(0, 212, 255, 0.05); }
        .answer-option.selected { border-color: var(--accent-cyan); background: rgba(0, 212, 255, 0.1); }
        .answer-option.correct { border-color: var(--success); background: rgba(0, 255, 136, 0.1); }
        .answer-option.incorrect { border-color: var(--error); background: rgba(255, 0, 110, 0.1); }
        .answer-letter {
            width: 32px; height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary);
            display: flex; align-items: center; justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }
        .answer-option.selected .answer-letter { background: var(--accent-cyan); color: var(--bg-primary); }
        .answer-option.correct .answer-letter { background: var(--success); color: var(--bg-primary); }
        .answer-option.incorrect .answer-letter { background: var(--error); color: white; }
        .explanation {
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-top: 1rem;
            border-left: 3px solid var(--accent-cyan);
        }
        .explanation-title { font-weight: 600; color: var(--accent-cyan); margin-bottom: 0.5rem; }
        .quiz-results { text-align: center; padding: 2rem; }
        .results-score {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        .results-label { font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 2rem; }
        .calculator-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; }
        .calc-card {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.5rem;
        }
        .calc-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .calc-form { display: flex; flex-direction: column; gap: 1rem; }
        .input-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .input-group label { font-size: 0.85rem; color: var(--text-secondary); }
        .calc-result { background: var(--bg-secondary); border-radius: var(--radius-sm); padding: 1rem; margin-top: 1rem; }
        .calc-result-label { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.25rem; }
        .calc-result-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-cyan); font-family: 'Space Mono', monospace; }
        .formula-categories { display: flex; gap: 0.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .formula-cat-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .formula-cat-btn:hover, .formula-cat-btn.active { background: rgba(0, 212, 255, 0.1); border-color: var(--accent-cyan); color: var(--accent-cyan); }
        .formula-list { display: grid; gap: 1rem; }
        .formula-item {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 1.25rem;
        }
        .formula-name { font-weight: 600; margin-bottom: 0.75rem; color: var(--accent-cyan); }
        .formula-equation {
            font-family: 'Space Mono', monospace;
            font-size: 1.2rem;
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin-bottom: 0.75rem;
            text-align: center;
        }
        .formula-desc { font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5; }
        .formula-vars { margin-top: 0.75rem; font-size: 0.85rem; color: var(--text-muted); }
        .experiment-card { position: relative; overflow: hidden; }
        .experiment-badge {
            position: absolute; top: 1rem; right: 1rem;
            background: var(--accent-purple);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .experiment-image {
            width: 100%; height: 120px;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary));
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
        }
        .mindmap-container { overflow: auto; }
        .mindmap-container svg { display: block; margin: 0 auto; }
        .mindmap-node { cursor: pointer; transition: all 0.3s ease; }
        .mindmap-node:hover { filter: brightness(1.2); }
        .mindmap-node circle { transition: all 0.3s ease; }
        .mindmap-node:hover circle { stroke-width: 3; }
        .mindmap-node text { pointer-events: none; font-family: 'DM Sans', sans-serif; font-size: 11px; fill: var(--text-primary); }
        .mindmap-link { stroke: rgba(0, 212, 255, 0.3); stroke-width: 2; fill: none; }
        .mindmap-center text { font-size: 14px; font-weight: 600; }
        .topic-view { display: none; }
        .topic-view.active { display: block; }
        .back-btn {
            display: inline-flex; align-items: center; gap: 0.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            margin-bottom: 1.5rem;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .back-btn:hover { color: var(--accent-cyan); }
        .topic-content {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            padding: 2rem;
        }
        .topic-content h2 { font-size: 1.5rem; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--glass-border); }
        .topic-content h3 { font-size: 1.2rem; margin: 1.5rem 0 1rem; color: var(--accent-cyan); }
        .topic-content p { line-height: 1.7; margin-bottom: 1rem; color: var(--text-secondary); }
        .topic-content ul, .topic-content ol { margin: 1rem 0; padding-left: 1.5rem; }
        .topic-content li { margin-bottom: 0.5rem; line-height: 1.6; color: var(--text-secondary); }
        .key-point {
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid var(--accent-cyan);
            padding: 1rem;
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            margin: 1rem 0;
        }
        .key-point-title { font-weight: 600; color: var(--accent-cyan); margin-bottom: 0.5rem; }
        .example-box { background: var(--bg-tertiary); border-radius: var(--radius-sm); padding: 1.25rem; margin: 1rem 0; }
        .example-title { font-weight: 600; margin-bottom: 0.75rem; color: var(--accent-yellow); }
        .balanced-result .coefficient { color: var(--accent-cyan); font-weight: 700; }
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .header-content { flex-direction: column; align-items: flex-start; }
            .user-stats { width: 100%; justify-content: flex-start; }
            .stat-pill { font-size: 0.75rem; padding: 0.4rem 0.75rem; }
            .main { padding: 1rem; }
            .section-title { font-size: 1.4rem; }
            .card-grid { grid-template-columns: 1fr; }
            .quick-actions { grid-template-columns: 1fr; }
            .element-properties { grid-template-columns: 1fr; }
            .flashcard-inner { height: 250px; }
            .calculator-grid { grid-template-columns: 1fr; }
            /* Grid navigation for tablets */
            .nav-container { overflow-x: visible; }
            .nav { flex-wrap: wrap; justify-content: center; gap: 0.35rem; }
            .nav-btn { padding: 0.6rem 1rem; font-size: 0.85rem; }
        }
        @media (max-width: 480px) {
            /* Compact grid nav for mobile */
            .nav { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.25rem; padding: 0.4rem; }
            .nav-btn {
                padding: 0.5rem 0.25rem;
                font-size: 0.7rem;
                flex-direction: column;
                gap: 0.2rem;
                justify-content: center;
                text-align: center;
            }
            .nav-btn .icon { font-size: 1.1rem; }
            .nav-btn span:not(.icon) { font-size: 0.6rem; display: block; line-height: 1.1; }
            .flashcard-controls { flex-direction: column; }
            select, input[type="text"], input[type="number"] { min-width: 100%; }
            .header { padding: 0.75rem 1rem; }
            .logo-text { font-size: 1.1rem; }
            .section-title { font-size: 1.25rem; }
            .modal { margin: 0.5rem; max-height: 95vh; }
            .quiz-question { padding: 1.25rem; }
            .flashcard-inner { height: 220px; }
            .flashcard-content { font-size: 1rem; }
            .btn { padding: 0.65rem 1.25rem; font-size: 0.85rem; }
            .results-score { font-size: 3rem; }
            .periodic-table { min-width: 750px; }
            .element { font-size: 0.55rem; }
            .element .symbol { font-size: 0.75rem; }
            .mindmap-container svg { height: 450px; }
        }
        @media (max-width: 360px) {
            .nav { grid-template-columns: repeat(3, 1fr); }
            .nav-btn span:not(.icon) { font-size: 0.55rem; }
            .header-content { gap: 0.5rem; }
            .stat-pill { padding: 0.35rem 0.6rem; font-size: 0.7rem; }
            .section-title { font-size: 1.1rem; }
            .card { padding: 1rem; }
            .topic-icon { width: 40px; height: 40px; font-size: 1.2rem; }
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--bg-tertiary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }
    </style>
</head>
<body>
    <div class="bg-molecules" id="bgMolecules"></div>
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <img src="icon-192.svg" alt="EnglishMaster LC" class="logo-icon" style="width: 40px; height: 40px; border-radius: 10px;">
                    <div>
                        <div class="logo-text">EnglishMaster LC</div>
                        <div class="logo-sub">English</div>
                    </div>
                </div>
                <div class="user-stats">
                    <div class="stat-pill"><span class="icon">üî•</span><span class="value" id="streakCount">0</span><span>day streak</span></div>
                    <div class="stat-pill"><span class="icon">‚≠ê</span><span class="value" id="xpCount">0</span><span>XP</span></div>
                </div>
            </div>
        </header>
        <div class="nav-container">
            <nav class="nav">
                <button class="nav-btn active" data-section="dashboard"><span class="icon">üìä</span><span>Dashboard</span></button>
                <button class="nav-btn" data-section="topics"><span class="icon">üìö</span><span>Topics</span></button>
                <button class="nav-btn" data-section="periodic"><span class="icon">üìú</span><span>Literary Terms</span></button>
                <button class="nav-btn" data-section="flashcards"><span class="icon">üÉè</span><span>Flashcards</span></button>
                <button class="nav-btn" data-section="quiz"><span class="icon">‚ùì</span><span>Quiz</span></button>
                <button class="nav-btn" data-section="calculator"><span class="icon">üìù</span><span>Writing Tools</span></button>
                <button class="nav-btn" data-section="formulas"><span class="icon">üìê</span><span>Formulas</span></button>
                <button class="nav-btn" data-section="mindmaps"><span class="icon">üß†</span><span>Mind Maps</span></button>
                <button class="nav-btn" data-section="experiments"><span class="icon">üí°</span><span>Techniques</span></button>
                <button class="nav-btn" data-section="dataTables"><span class="icon">üìã</span><span>Data Tables</span></button>
                <button class="nav-btn" data-section="glossary"><span class="icon">üìñ</span><span>Glossary</span></button>
                <button class="nav-btn" data-section="examMode"><span class="icon">üéØ</span><span>Exam Mode</span></button>
            </nav>
        </div>
        <main class="main">
            <!-- Dashboard -->
            <section class="section active" id="dashboard">
                <div class="section-header">
                    <h1 class="section-title">Welcome back! üëã</h1>
                    <p class="section-subtitle">Continue your English journey</p>
                </div>
                <div class="dashboard-grid">
                    <div>
                        <div class="card" style="margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                            <div class="quick-actions">
                                <a class="quick-action" data-goto="flashcards"><span class="icon">üÉè</span><span class="label">Daily Review</span></a>
                                <a class="quick-action" data-goto="quiz"><span class="icon">‚ùì</span><span class="label">Practice Quiz</span></a>
                                <a class="quick-action" data-goto="mindmaps"><span class="icon">üß†</span><span class="label">Mind Maps</span></a>
                                <a class="quick-action" data-goto="calculator"><span class="icon">üßÆ</span><span class="label">Calculators</span></a>
                            </div>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 1rem;">Continue Learning</h3>
                            <div id="recentTopics"></div>
                        </div>
                    </div>
                    <div>
                        <div class="card" style="margin-bottom: 1.5rem;">
                            <h3 style="margin-bottom: 1rem; text-align: center;">Overall Progress</h3>
                            <svg class="progress-ring" viewBox="0 0 120 120">
                                <circle class="bg" cx="60" cy="60" r="52"/>
                                <circle class="progress" cx="60" cy="60" r="52" stroke-dasharray="327" stroke-dashoffset="327" id="progressCircle"/>
                                <text class="progress-text" x="60" y="60" id="progressPercent">0%</text>
                            </svg>
                            <div style="text-align: center; color: var(--text-secondary); font-size: 0.9rem;">
                                <span id="topicsCompleted">0</span> of <span id="totalTopics">10</span> topics started
                            </div>
                        </div>
                        <div class="card">
                            <h3 style="margin-bottom: 1rem;">Today's Goals</h3>
                            <div id="dailyGoals">
                                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="goal1" style="width: 18px; height: 18px;">
                                    <label for="goal1" style="flex: 1; font-size: 0.9rem;">Complete 10 flashcards</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                                    <input type="checkbox" id="goal2" style="width: 18px; height: 18px;">
                                    <label for="goal2" style="flex: 1; font-size: 0.9rem;">Pass one quiz</label>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: var(--radius-sm);">
                                    <input type="checkbox" id="goal3" style="width: 18px; height: 18px;">
                                    <label for="goal3" style="flex: 1; font-size: 0.9rem;">Study for 30 minutes</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <h3 style="margin-bottom: 1rem; text-align: center;">‚è∞ Exam Countdown</h3>
                            <div id="examCountdown" style="text-align: center;">
                                <div style="font-size: 2.5rem; font-weight: 700; color: var(--accent-cyan);" id="daysUntilExam">--</div>
                                <div style="color: var(--text-secondary); font-size: 0.9rem;">days until LC English</div>
                                <div style="color: var(--text-muted); font-size: 0.8rem; margin-top: 0.5rem;" id="examDate">June 2025</div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <h3 style="margin-bottom: 1rem; text-align: center;">üçÖ Pomodoro Timer</h3>
                            <div style="text-align: center;">
                                <div style="font-size: 3rem; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--text-primary);" id="pomodoroDisplay">25:00</div>
                                <div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 1rem;" id="pomodoroStatus">Focus Time</div>
                                <div style="display: flex; gap: 0.5rem; justify-content: center;">
                                    <button class="btn btn-primary" id="pomodoroStart" onclick="togglePomodoro()">Start</button>
                                    <button class="btn btn-secondary" onclick="resetPomodoro()">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Topics -->
            <section class="section" id="topics">
                <div class="section-header">
                    <h1 class="section-title">üìö Study Topics</h1>
                    <p class="section-subtitle">Complete coverage of the LC English syllabus</p>
                </div>
                <div class="card-grid" id="topicsGrid"></div>
                <div class="topic-view" id="topicView">
                    <a class="back-btn" id="backToTopics">‚Üê Back to Topics</a>
                    <div class="topic-content" id="topicContent"></div>
                </div>
            </section>

            <!-- Literary Terms -->
            <section class="section" id="periodic">
                <div class="section-header">
                    <h1 class="section-title">üìú Literary Terms Reference</h1>
                    <p class="section-subtitle">Click any term to learn more</p>
                </div>
                <div class="card" style="margin-bottom: 1rem;">
                    <div class="formula-categories">
                        <button class="formula-cat-btn active" data-litcat="poetry">Poetry Terms</button>
                        <button class="formula-cat-btn" data-litcat="drama">Drama Terms</button>
                        <button class="formula-cat-btn" data-litcat="prose">Prose/Novel Terms</button>
                        <button class="formula-cat-btn" data-litcat="rhetoric">Rhetoric & Persuasion</button>
                        <button class="formula-cat-btn" data-litcat="language">Language Features</button>
                    </div>
                </div>
                <div class="card">
                    <div id="literaryTermsContent" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
                </div>
            </section>

            <!-- Flashcards -->
            <section class="section" id="flashcards">
                <div class="section-header">
                    <h1 class="section-title">üÉè Flashcards</h1>
                    <p class="section-subtitle">Master key concepts with spaced repetition</p>
                </div>
                <div class="card">
                    <div class="flashcard-controls">
                        <div class="control-group">
                            <span class="control-label">Topic</span>
                            <select id="flashcardTopic">
                                <option value="all">All Topics</option>
                                <option value="poetry">Poetry</option>
                                <option value="shakespeare">Shakespeare</option>
                                <option value="comparative">Comparative Study</option>
                                <option value="novel">Single Text (Novel)</option>
                                <option value="comprehension">Comprehension</option>
                                <option value="composing">Composing</option>
                                <option value="language">Language of Narration</option>
                                <option value="persuasion">Language of Argument</option>
                                <option value="information">Language of Information</option>
                                <option value="drama">Drama</option>
                            </select>
                        </div>
                        <div style="margin-left: auto;">
                            <button class="btn btn-primary" id="startFlashcards">Start Session</button>
                        </div>
                    </div>
                    <div class="flashcard-area" id="flashcardArea">
                        <div class="flashcard" id="flashcard">
                            <div class="flashcard-inner">
                                <div class="flashcard-front">
                                    <div class="flashcard-label">Question</div>
                                    <div class="flashcard-content" id="flashcardQuestion">Select a topic and click "Start Session" to begin</div>
                                    <div class="flashcard-hint">Click to flip</div>
                                </div>
                                <div class="flashcard-back">
                                    <div class="flashcard-label">Answer</div>
                                    <div class="flashcard-content" id="flashcardAnswer">The answer will appear here</div>
                                </div>
                            </div>
                        </div>
                        <div class="flashcard-nav">
                            <button class="btn btn-secondary btn-icon" id="prevCard" disabled>‚Üê</button>
                            <span class="card-counter"><span id="currentCard">0</span> / <span id="totalCards">0</span></span>
                            <button class="btn btn-secondary btn-icon" id="nextCard" disabled>‚Üí</button>
                        </div>
                        <div class="rating-buttons" id="ratingButtons" style="display: none;">
                            <button class="rating-btn hard">üòì Hard</button>
                            <button class="rating-btn good">üëç Good</button>
                            <button class="rating-btn easy">üåü Easy</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quiz -->
            <section class="section" id="quiz">
                <div class="section-header">
                    <h1 class="section-title">‚ùì Practice Quiz</h1>
                    <p class="section-subtitle">Test your knowledge with exam-style questions</p>
                </div>
                <div class="quiz-setup" id="quizSetup">
                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">Select Topic</h3>
                        <div class="quiz-options" id="quizTopicOptions"></div>
                        <h3 style="margin-bottom: 1rem; margin-top: 1.5rem;">Number of Questions</h3>
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                            <button class="quiz-option selected" data-questions="5">5 Questions</button>
                            <button class="quiz-option" data-questions="10">10 Questions</button>
                            <button class="quiz-option" data-questions="20">20 Questions</button>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;" id="startQuiz">Start Quiz</button>
                    </div>
                </div>
                <div class="quiz-area" id="quizArea" style="display: none;">
                    <div class="quiz-progress">
                        <span id="quizQuestionNum">1/10</span>
                        <div class="progress-bar"><div class="progress-fill" id="quizProgressBar" style="width: 10%;"></div></div>
                        <span id="quizScore">Score: 0</span>
                    </div>
                    <div class="quiz-question" id="quizQuestionArea"></div>
                    <div style="display: flex; justify-content: space-between;">
                        <button class="btn btn-secondary" id="quitQuiz">Quit</button>
                        <button class="btn btn-primary" id="nextQuestion" style="display: none;">Next Question ‚Üí</button>
                    </div>
                </div>
                <div class="quiz-results card" id="quizResults" style="display: none;">
                    <h2 style="margin-bottom: 1rem;">Quiz Complete! üéâ</h2>
                    <div class="results-score" id="finalScore">80%</div>
                    <div class="results-label" id="finalScoreLabel">8 out of 10 correct</div>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="retakeQuiz">Try Again</button>
                    </div>
                </div>
            </section>

            <!-- Writing Tools -->
            <section class="section" id="calculator">
                <div class="section-header">
                    <h1 class="section-title">‚úçÔ∏è Writing Tools</h1>
                    <p class="section-subtitle">Essential tools for improving your English writing</p>
                </div>
                <div class="calculator-grid">
                    <div class="calc-card">
                        <h3 class="calc-title">üìù Word Counter</h3>
                        <div class="calc-form">
                            <div class="input-group"><label>Enter your text</label><textarea id="wordCountText" placeholder="Paste or type your essay here..." rows="4" style="width:100%; resize:vertical;"></textarea></div>
                            <button class="btn btn-primary" onclick="countWords()">Count Words</button>
                            <div class="calc-result"><div class="calc-result-label">Word Count</div><div class="calc-result-value" id="wordCountResult">‚Äî</div></div>
                            <div id="wordCountDetails" style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);"></div>
                        </div>
                    </div>
                    <div class="calc-card">
                        <h3 class="calc-title">‚è±Ô∏è Essay Timer</h3>
                        <div class="calc-form">
                            <div class="input-group"><label>Time Limit (minutes)</label><input type="number" id="essayTimeLimit" placeholder="e.g., 45" value="45"></div>
                            <button class="btn btn-primary" onclick="startEssayTimer()">Start Timer</button>
                            <button class="btn btn-secondary" onclick="stopEssayTimer()" style="margin-top:0.5rem;">Stop</button>
                            <div class="calc-result"><div class="calc-result-label">Time Remaining</div><div class="calc-result-value" id="essayTimerResult">45:00</div></div>
                        </div>
                    </div>
                    <div class="calc-card">
                        <h3 class="calc-title">üìä Reading Time Estimator</h3>
                        <div class="calc-form">
                            <div class="input-group"><label>Word Count</label><input type="number" id="readingWordCount" placeholder="Enter word count"></div>
                            <div class="input-group"><label>Reading Speed (WPM)</label><input type="number" id="readingSpeed" placeholder="200" value="200"></div>
                            <button class="btn btn-primary" onclick="calculateReadingTime()">Calculate</button>
                            <div class="calc-result"><div class="calc-result-label">Reading Time</div><div class="calc-result-value" id="readingTimeResult">‚Äî</div></div>
                        </div>
                    </div>
                    <div class="calc-card">
                        <h3 class="calc-title">üìê Paragraph Planner</h3>
                        <div class="calc-form">
                            <div class="input-group"><label>Essay Type</label>
                                <select id="essayType" style="width:100%; padding:0.5rem;">
                                    <option value="personal">Personal Essay (5-6 paras)</option>
                                    <option value="discursive">Discursive Essay (6-7 paras)</option>
                                    <option value="short">Short Story (varies)</option>
                                    <option value="speech">Speech (5-6 paras)</option>
                                    <option value="article">Article (5-6 paras)</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="showEssayStructure()">Show Structure</button>
                            <div id="essayStructureResult" style="margin-top: 1rem; font-size: 0.9rem; text-align: left;"></div>
                        </div>
                    </div>
                    <div class="calc-card">
                        <h3 class="calc-title">üéØ PCLM Checker</h3>
                        <div class="calc-form">
                            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">Rate your writing against LC marking criteria</p>
                            <div class="input-group"><label>Purpose (clear aim?)</label><input type="range" id="pclmP" min="0" max="10" value="5" style="width:100%;"></div>
                            <div class="input-group"><label>Coherence (logical flow?)</label><input type="range" id="pclmC" min="0" max="10" value="5" style="width:100%;"></div>
                            <div class="input-group"><label>Language (vocabulary?)</label><input type="range" id="pclmL" min="0" max="10" value="5" style="width:100%;"></div>
                            <div class="input-group"><label>Mechanics (grammar/spelling?)</label><input type="range" id="pclmM" min="0" max="10" value="5" style="width:100%;"></div>
                            <button class="btn btn-primary" onclick="calculatePCLM()">Calculate Score</button>
                            <div class="calc-result"><div class="calc-result-label">Estimated %</div><div class="calc-result-value" id="pclmResult">‚Äî</div></div>
                        </div>
                    </div>
                    <div class="calc-card">
                        <h3 class="calc-title">üí° Transition Words</h3>
                        <div class="calc-form">
                            <div class="input-group"><label>Category</label>
                                <select id="transitionCategory" onchange="showTransitions()" style="width:100%; padding:0.5rem;">
                                    <option value="addition">Addition</option>
                                    <option value="contrast">Contrast</option>
                                    <option value="cause">Cause & Effect</option>
                                    <option value="sequence">Sequence</option>
                                    <option value="conclusion">Conclusion</option>
                                    <option value="emphasis">Emphasis</option>
                                </select>
                            </div>
                            <div id="transitionsList" style="margin-top: 1rem; font-size: 0.9rem; text-align: left; line-height: 1.8;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Writing Frameworks -->
            <section class="section" id="formulas">
                <div class="section-header">
                    <h1 class="section-title">üìê Writing Frameworks</h1>
                    <p class="section-subtitle">Structures and templates for LC English writing tasks</p>
                </div>
                <div class="formula-categories">
                    <button class="formula-cat-btn active" data-category="all">All</button>
                    <button class="formula-cat-btn" data-category="essay">Essay Writing</button>
                    <button class="formula-cat-btn" data-category="poetry">Poetry Analysis</button>
                    <button class="formula-cat-btn" data-category="comparative">Comparative</button>
                    <button class="formula-cat-btn" data-category="comprehension">Comprehension</button>
                    <button class="formula-cat-btn" data-category="language">Language Analysis</button>
                    <button class="formula-cat-btn" data-category="drama">Drama</button>
                </div>
                <div class="formula-list" id="formulaList"></div>
            </section>

            <!-- Mind Maps -->
            <section class="section" id="mindmaps">
                <div class="section-header">
                    <h1 class="section-title">üß† Mind Maps</h1>
                    <p class="section-subtitle">Visual concept maps for each topic - click nodes to explore</p>
                </div>
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="control-group">
                        <span class="control-label">Select Topic</span>
                        <select id="mindmapTopic" onchange="renderMindMap(this.value)">
                            <option value="poetry">Poetry Analysis</option>
                            <option value="shakespeare">Shakespeare</option>
                            <option value="comparative">Comparative Study</option>
                            <option value="novel">Single Text (Novel)</option>
                            <option value="composing">Composing</option>
                            <option value="comprehension">Comprehension</option>
                            <option value="persuasion">Language of Argument</option>
                            <option value="drama">Drama</option>
                        </select>
                    </div>
                </div>
                <div class="card">
                    <div class="mindmap-container" id="mindmapContainer">
                        <svg id="mindmapSvg" width="100%" height="600" viewBox="0 0 1000 600"></svg>
                    </div>
                    <div class="mindmap-info" id="mindmapInfo" style="margin-top: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-sm); display: none;">
                        <h4 id="mindmapInfoTitle" style="color: var(--accent-cyan); margin-bottom: 0.5rem;"></h4>
                        <p id="mindmapInfoDesc" style="color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;"></p>
                    </div>
                </div>
            </section>

            <!-- Writing Techniques -->
            <section class="section" id="experiments">
                <div class="section-header">
                    <h1 class="section-title">üí° Writing Techniques</h1>
                    <p class="section-subtitle">Step-by-step guides for essays, analysis, and compositions</p>
                </div>
                <div class="card-grid" id="experimentsGrid"></div>
            </section>

            <!-- Data Tables -->
            <section class="section" id="dataTables">
                <div class="section-header">
                    <h1 class="section-title">üìã Exam Reference</h1>
                    <p class="section-subtitle">Essential reference data for exam preparation</p>
                </div>

                <div class="formula-categories">
                    <button class="formula-cat-btn active" data-table="examStructure">Exam Structure</button>
                    <button class="formula-cat-btn" data-table="markingSchemes">Marking Criteria</button>
                    <button class="formula-cat-btn" data-table="essayTypes">Essay Types</button>
                    <button class="formula-cat-btn" data-table="poets">Prescribed Poets</button>
                    <button class="formula-cat-btn" data-table="comparative">Comparative Texts</button>
                </div>
                
                <div class="card">
                    <div id="dataTableContent"></div>
                </div>
            </section>

            <!-- Glossary -->
            <section class="section" id="glossary">
                <div class="section-header">
                    <h1 class="section-title">üìñ English Glossary</h1>
                    <p class="section-subtitle">Searchable definitions of literary and language terms</p>
                </div>
                
                <div class="card" style="margin-bottom: 1.5rem;">
                    <div class="input-group">
                        <input type="text" id="glossarySearch" placeholder="Search terms..." oninput="filterGlossary(this.value)" style="width: 100%;">
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                        <button class="formula-cat-btn active" data-glossary="all" onclick="filterGlossaryCategory('all')">All</button>
                        <button class="formula-cat-btn" data-glossary="poetry" onclick="filterGlossaryCategory('poetry')">Poetry</button>
                        <button class="formula-cat-btn" data-glossary="drama" onclick="filterGlossaryCategory('drama')">Drama</button>
                        <button class="formula-cat-btn" data-glossary="prose" onclick="filterGlossaryCategory('prose')">Prose</button>
                        <button class="formula-cat-btn" data-glossary="rhetoric" onclick="filterGlossaryCategory('rhetoric')">Rhetoric</button>
                        <button class="formula-cat-btn" data-glossary="language" onclick="filterGlossaryCategory('language')">Language</button>
                        <button class="formula-cat-btn" data-glossary="writing" onclick="filterGlossaryCategory('writing')">Writing</button>
                    </div>
                </div>
                
                <div class="card">
                    <div id="glossaryContent"></div>
                </div>
            </section>

            <!-- Exam Mode -->
            <section class="section" id="examMode">
                <div class="section-header">
                    <h1 class="section-title">üéØ Exam Mode</h1>
                    <p class="section-subtitle">Timed practice under exam conditions</p>
                </div>
                
                <div id="examSetup">
                    <div class="card" style="max-width: 600px; margin: 0 auto;">
                        <h3 style="margin-bottom: 1.5rem; text-align: center;">Configure Your Exam</h3>
                        
                        <div class="input-group" style="margin-bottom: 1rem;">
                            <label>Exam Type</label>
                            <select id="examType" style="width: 100%;">
                                <option value="mixed">Mixed Questions (All Topics)</option>
                                <option value="section-a">Section A Style (Short Questions)</option>
                                <option value="section-b">Section B Style (Long Questions)</option>
                            </select>
                        </div>
                        
                        <div class="input-group" style="margin-bottom: 1rem;">
                            <label>Difficulty Level</label>
                            <select id="examLevel" style="width: 100%;">
                                <option value="higher">Higher Level</option>
                                <option value="ordinary">Ordinary Level</option>
                            </select>
                        </div>
                        
                        <div class="input-group" style="margin-bottom: 1rem;">
                            <label>Time Limit</label>
                            <select id="examTime" style="width: 100%;">
                                <option value="15">15 minutes (Quick Practice)</option>
                                <option value="30">30 minutes (Half Exam)</option>
                                <option value="60">60 minutes (Full Practice)</option>
                                <option value="0">No Time Limit</option>
                            </select>
                        </div>
                        
                        <div class="input-group" style="margin-bottom: 1.5rem;">
                            <label>Number of Questions</label>
                            <select id="examQuestions" style="width: 100%;">
                                <option value="10">10 Questions</option>
                                <option value="20">20 Questions</option>
                                <option value="30">30 Questions</option>
                            </select>
                        </div>
                        
                        <div style="background: var(--bg-tertiary); border-radius: var(--radius-sm); padding: 1rem; margin-bottom: 1.5rem;">
                            <h4 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">‚ö†Ô∏è Exam Conditions</h4>
                            <ul style="font-size: 0.85rem; color: var(--text-secondary); margin: 0; padding-left: 1.25rem;">
                                <li>Timer will count down (if enabled)</li>
                                <li>Cannot go back to previous questions</li>
                                <li>No hints or explanations until the end</li>
                                <li>Results shown only after completion</li>
                            </ul>
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%;" onclick="startExamMode()">üéØ Start Exam</button>
                    </div>
                </div>
                
                <div id="examInProgress" style="display: none;">
                    <div class="card" style="max-width: 800px; margin: 0 auto;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--glass-border);">
                            <div>
                                <span style="font-size: 0.85rem; color: var(--text-muted);">Question</span>
                                <div style="font-size: 1.25rem; font-weight: 600;" id="examQuestionNum">1 of 20</div>
                            </div>
                            <div style="text-align: center;">
                                <span style="font-size: 0.85rem; color: var(--text-muted);">Time Remaining</span>
                                <div style="font-size: 1.5rem; font-weight: 700; font-family: 'Space Mono', monospace; color: var(--accent-cyan);" id="examTimer">30:00</div>
                            </div>
                            <div style="text-align: right;">
                                <span style="font-size: 0.85rem; color: var(--text-muted);">Answered</span>
                                <div style="font-size: 1.25rem; font-weight: 600;" id="examAnswered">0 / 20</div>
                            </div>
                        </div>
                        
                        <div id="examQuestionContent"></div>
                        
                        <div style="display: flex; justify-content: space-between; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="endExamEarly()">End Exam</button>
                            <button class="btn btn-primary" id="examNextBtn" onclick="nextExamQuestion()">Next Question ‚Üí</button>
                        </div>
                    </div>
                </div>
                
                <div id="examResults" style="display: none;">
                    <div class="card" style="max-width: 600px; margin: 0 auto; text-align: center;">
                        <h2 style="margin-bottom: 1rem;">üìä Exam Results</h2>
                        <div class="results-score" id="examFinalScore">75%</div>
                        <div class="results-label" id="examScoreLabel">15 out of 20 correct</div>
                        
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0;">
                            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-green);" id="examCorrectCount">15</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Correct</div>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-magenta);" id="examWrongCount">5</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Incorrect</div>
                            </div>
                            <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: var(--accent-cyan);" id="examTimeSpent">24:32</div>
                                <div style="font-size: 0.8rem; color: var(--text-muted);">Time Taken</div>
                            </div>
                        </div>
                        
                        <div id="examGrade" style="background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple)); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 1.5rem;">
                            <div style="font-size: 0.9rem; opacity: 0.8;">Predicted Grade</div>
                            <div style="font-size: 2.5rem; font-weight: 700;">H2</div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-secondary" onclick="reviewExamAnswers()">Review Answers</button>
                            <button class="btn btn-primary" onclick="resetExamMode()">Try Again</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Term Details Modal -->
    <div class="modal-overlay" id="elementModal">
        <div class="modal">
            <div class="modal-header"><h3>Term Details</h3><button class="modal-close" id="closeModal">√ó</button></div>
            <div class="modal-body" id="elementModalBody"></div>
        </div>
    </div>

    <script>
        // ==================== DATA ====================
        const literaryTerms = {
            poetry: [
                { term: 'Metaphor', def: 'A direct comparison between two things without using "like" or "as".', example: '"Life is a journey"' },
                { term: 'Simile', def: 'A comparison using "like" or "as".', example: '"Her eyes sparkled like stars"' },
                { term: 'Personification', def: 'Giving human qualities to non-human things.', example: '"The wind whispered through the trees"' },
                { term: 'Alliteration', def: 'Repetition of consonant sounds at the beginning of words.', example: '"Peter Piper picked a peck"' },
                { term: 'Assonance', def: 'Repetition of vowel sounds within words.', example: '"The rain in Spain stays mainly"' },
                { term: 'Onomatopoeia', def: 'Words that imitate sounds.', example: '"buzz", "crash", "whisper"' },
                { term: 'Imagery', def: 'Descriptive language that appeals to the senses.', example: 'Visual, auditory, tactile, olfactory, gustatory' },
                { term: 'Symbolism', def: 'Using objects or images to represent abstract ideas.', example: 'A dove symbolising peace' },
                { term: 'Enjambment', def: 'Running a sentence from one line to the next without pause.', example: 'Creates flow and urgency' },
                { term: 'Caesura', def: 'A pause in the middle of a line of poetry.', example: '"To be, || or not to be"' }
            ],
            drama: [
                { term: 'Soliloquy', def: 'A speech where a character reveals thoughts aloud, alone on stage.', example: 'Hamlet\'s "To be or not to be"' },
                { term: 'Aside', def: 'A remark spoken to the audience, unheard by other characters.', example: 'Used for dramatic irony' },
                { term: 'Dramatic Irony', def: 'When the audience knows something characters do not.', example: 'Romeo thinking Juliet is dead' },
                { term: 'Tragedy', def: 'A drama ending in catastrophe for the protagonist.', example: 'Macbeth, Hamlet, King Lear' },
                { term: 'Tragic Hero', def: 'A noble protagonist whose flaw leads to downfall.', example: 'Macbeth\'s ambition' },
                { term: 'Hamartia', def: 'The tragic hero\'s fatal flaw.', example: 'Othello\'s jealousy' },
                { term: 'Catharsis', def: 'Emotional release experienced by the audience.', example: 'Pity and fear in tragedy' },
                { term: 'Foil', def: 'A character who contrasts with another to highlight traits.', example: 'Banquo as foil to Macbeth' },
                { term: 'Monologue', def: 'A long speech by one character to others on stage.', example: 'Different from soliloquy' },
                { term: 'Stage Directions', def: 'Instructions in the script about movement, setting, tone.', example: '[Exit, pursued by a bear]' }
            ],
            prose: [
                { term: 'Narrator', def: 'The voice telling the story.', example: 'First person, third person, omniscient' },
                { term: 'Point of View', def: 'The perspective from which a story is told.', example: 'First person (I), Third person (he/she)' },
                { term: 'Foreshadowing', def: 'Hints about what will happen later in the story.', example: 'Creates suspense and anticipation' },
                { term: 'Flashback', def: 'A scene set earlier than the main story.', example: 'Reveals backstory' },
                { term: 'Stream of Consciousness', def: 'Writing that mimics the flow of thoughts.', example: 'James Joyce\'s style' },
                { term: 'Protagonist', def: 'The main character of a narrative.', example: 'Often the hero or central figure' },
                { term: 'Antagonist', def: 'The character opposing the protagonist.', example: 'The villain or obstacle' },
                { term: 'Setting', def: 'The time and place of a story.', example: 'Creates atmosphere and context' },
                { term: 'Theme', def: 'The central idea or message of a work.', example: 'Love, death, identity, power' },
                { term: 'Motif', def: 'A recurring element with symbolic significance.', example: 'Blood in Macbeth' }
            ],
            rhetoric: [
                { term: 'Ethos', def: 'Appeal to credibility and ethics.', example: 'Establishing authority' },
                { term: 'Pathos', def: 'Appeal to emotions.', example: 'Evoking sympathy or fear' },
                { term: 'Logos', def: 'Appeal to logic and reason.', example: 'Using statistics and evidence' },
                { term: 'Rhetorical Question', def: 'A question asked for effect, not expecting an answer.', example: '"Is this what we want?"' },
                { term: 'Anaphora', def: 'Repetition of words at the start of successive clauses.', example: '"We shall fight... We shall fight..."' },
                { term: 'Hyperbole', def: 'Deliberate exaggeration for emphasis.', example: '"I\'ve told you a million times"' },
                { term: 'Understatement', def: 'Deliberately downplaying something.', example: '"It\'s just a scratch" (for a major injury)' },
                { term: 'Antithesis', def: 'Contrasting ideas in balanced phrases.', example: '"Ask not what your country can do for you"' },
                { term: 'Tricolon', def: 'A series of three parallel elements.', example: '"Veni, vidi, vici"' },
                { term: 'Juxtaposition', def: 'Placing contrasting elements side by side.', example: 'Light and darkness imagery' }
            ],
            language: [
                { term: 'Tone', def: 'The writer\'s attitude toward the subject.', example: 'Sarcastic, sincere, melancholic' },
                { term: 'Mood', def: 'The atmosphere created for the reader.', example: 'Tense, peaceful, ominous' },
                { term: 'Diction', def: 'Word choice and style of expression.', example: 'Formal, colloquial, archaic' },
                { term: 'Syntax', def: 'The arrangement of words in sentences.', example: 'Short sentences create tension' },
                { term: 'Register', def: 'Level of formality in language.', example: 'Formal, informal, technical' },
                { term: 'Irony', def: 'Saying one thing but meaning another.', example: 'Verbal, situational, dramatic' },
                { term: 'Euphemism', def: 'A mild expression for something harsh.', example: '"Passed away" for "died"' },
                { term: 'Oxymoron', def: 'Combining contradictory terms.', example: '"Deafening silence"' },
                { term: 'Paradox', def: 'A statement that seems contradictory but reveals truth.', example: '"Less is more"' },
                { term: 'Connotation', def: 'The emotional associations of a word.', example: '"Home" vs "house"' }
            ]
        };

        const topics = [
            { id: 'poetry', icon: 'üìù', title: 'Poetry', desc: 'Prescribed poets, poetry techniques, analysis skills', lessons: 15, questions: 60, progress: 0, content: '<h2>Poetry</h2><h3>Prescribed Poets</h3><p>Study of selected poems from prescribed poets on the LC syllabus, including Yeats, Plath, Heaney, Bishop, Boland, and others.</p><div class="key-point"><div class="key-point-title">Poetry Analysis</div><ul><li>Theme and subject matter</li><li>Imagery and symbolism</li><li>Tone and mood</li><li>Structure and form</li><li>Language techniques</li></ul></div>' },
            { id: 'shakespeare', icon: 'üé≠', title: 'Shakespeare', desc: 'Hamlet, Macbeth, King Lear, Othello - themes, characters', lessons: 12, questions: 55, progress: 0, content: '<h2>Shakespeare</h2><h3>Prescribed Plays</h3><p>In-depth study of your prescribed Shakespeare play, examining themes, characters, dramatic techniques, and language.</p><div class="key-point"><div class="key-point-title">Key Areas</div><ul><li>Tragic hero and fatal flaw</li><li>Soliloquies and asides</li><li>Imagery and motifs</li><li>Character development</li><li>Historical context</li></ul></div>' },
            { id: 'comparative', icon: 'üìö', title: 'Comparative Study', desc: 'Comparing texts across themes, modes, literary genre', lessons: 14, questions: 48, progress: 0, content: '<h2>Comparative Study</h2><h3>Modes of Comparison</h3><div class="key-point"><div class="key-point-title">The Three Modes</div><ul><li><strong>Theme/Issue:</strong> Love, power, identity, family</li><li><strong>Literary Genre:</strong> How texts use genre conventions</li><li><strong>General Vision and Viewpoint:</strong> Optimistic, pessimistic, realistic</li></ul></div><p>Compare at least three texts (novel, play, film) exploring similarities and differences.</p>' },
            { id: 'novel', icon: 'üìñ', title: 'Single Text (Novel)', desc: 'Novel study - plot, character, theme, technique', lessons: 10, questions: 45, progress: 0, content: '<h2>Single Text - Novel</h2><h3>Novel Analysis</h3><p>Study your prescribed novel in detail, examining narrative techniques, characterisation, themes, and style.</p><div class="key-point"><div class="key-point-title">Key Elements</div><ul><li>Narrative voice and perspective</li><li>Plot structure</li><li>Characterisation</li><li>Setting and atmosphere</li><li>Themes and motifs</li></ul></div>' },
            { id: 'comprehension', icon: 'üìÑ', title: 'Comprehension', desc: 'Reading comprehension strategies and techniques', lessons: 8, questions: 50, progress: 0, content: '<h2>Comprehension</h2><h3>Paper 1 Question A</h3><p>Develop skills for analysing unseen texts including visual, narrative, argumentative, and informative texts.</p><div class="key-point"><div class="key-point-title">Question Types</div><ul><li>Style and language analysis</li><li>Main idea identification</li><li>Inference and deduction</li><li>Visual text analysis</li></ul></div>' },
            { id: 'composing', icon: '‚úçÔ∏è', title: 'Composing', desc: 'Essays, speeches, articles, short stories, blogs', lessons: 12, questions: 40, progress: 0, content: '<h2>Composing</h2><h3>Paper 1 Question B</h3><div class="key-point"><div class="key-point-title">Composition Types</div><ul><li><strong>Personal Essay:</strong> Reflective, narrative</li><li><strong>Discursive Essay:</strong> Argumentative, opinion</li><li><strong>Short Story:</strong> Narrative, creative</li><li><strong>Speech:</strong> Persuasive, informative</li><li><strong>Article/Blog:</strong> Journalistic style</li></ul></div>' },
            { id: 'language', icon: 'üó£Ô∏è', title: 'Language of Narration', desc: 'Narrative techniques, genre, aesthetic language', lessons: 8, questions: 38, progress: 0, content: '<h2>Language of Narration</h2><h3>Narrative Techniques</h3><ul><li><strong>First Person:</strong> I, we - intimate, limited</li><li><strong>Third Person Limited:</strong> He/she - focused perspective</li><li><strong>Third Person Omniscient:</strong> All-knowing narrator</li><li><strong>Unreliable Narrator:</strong> Questionable perspective</li></ul><div class="key-point"><div class="key-point-title">Aesthetic Language</div><p>How writers use language for artistic effect: imagery, symbolism, rhythm, sound devices.</p></div>' },
            { id: 'persuasion', icon: 'üí¨', title: 'Language of Argument', desc: 'Persuasive techniques, rhetoric, logical argument', lessons: 9, questions: 42, progress: 0, content: '<h2>Language of Argument</h2><h3>Persuasive Techniques</h3><div class="key-point"><div class="key-point-title">Rhetorical Appeals</div><ul><li><strong>Ethos:</strong> Credibility, ethics</li><li><strong>Pathos:</strong> Emotional appeal</li><li><strong>Logos:</strong> Logic, reasoning</li></ul></div><h3>Techniques</h3><ul><li>Rhetorical questions</li><li>Repetition and parallelism</li><li>Statistics and evidence</li><li>Anecdote and example</li></ul>' },
            { id: 'information', icon: 'üìä', title: 'Language of Information', desc: 'Reports, instructions, information texts', lessons: 6, questions: 35, progress: 0, content: '<h2>Language of Information</h2><h3>Informative Texts</h3><p>Texts that aim to inform, explain, or instruct the reader.</p><div class="key-point"><div class="key-point-title">Features</div><ul><li>Clear, factual language</li><li>Logical organisation</li><li>Headings and subheadings</li><li>Visual aids (charts, diagrams)</li><li>Objective tone</li></ul></div>' },
            { id: 'drama', icon: 'üé™', title: 'Drama (Non-Shakespeare)', desc: 'Modern drama, dramatic techniques, staging', lessons: 10, questions: 40, progress: 0, content: '<h2>Drama</h2><h3>Modern Drama Study</h3><p>Study of prescribed drama texts exploring theatrical conventions and dramatic techniques.</p><div class="key-point"><div class="key-point-title">Dramatic Elements</div><ul><li>Stage directions</li><li>Dialogue and monologue</li><li>Dramatic irony</li><li>Tension and conflict</li><li>Themes and symbolism</li></ul></div>' }
        ];

        const flashcardsData = {
            poetry: [
                { q: "What is a metaphor?", a: "A direct comparison between two things without using 'like' or 'as'" },
                { q: "What is a simile?", a: "A comparison using 'like' or 'as'" },
                { q: "What is personification?", a: "Giving human qualities to non-human things" },
                { q: "What is alliteration?", a: "Repetition of consonant sounds at the beginning of words" },
                { q: "What is assonance?", a: "Repetition of vowel sounds within words" },
                { q: "What is enjambment?", a: "When a sentence continues from one line to the next without punctuation" },
                { q: "What is a volta?", a: "A turn or shift in thought or argument in a poem, especially in a sonnet" }
            ],
            shakespeare: [
                { q: "What is a tragic hero?", a: "A protagonist of high status with a fatal flaw that leads to their downfall" },
                { q: "What is a soliloquy?", a: "A speech where a character speaks their thoughts aloud, alone on stage" },
                { q: "What is dramatic irony?", a: "When the audience knows something the characters do not" },
                { q: "What is iambic pentameter?", a: "A line of verse with five metrical feet, each with an unstressed then stressed syllable" },
                { q: "What is hamartia?", a: "The fatal flaw or error in judgement of a tragic hero" },
                { q: "What is an aside?", a: "A remark spoken by a character, heard by the audience but not other characters" }
            ],
            comparative: [
                { q: "What is Theme/Issue mode?", a: "Comparing how texts explore the same theme (e.g., love, power, identity)" },
                { q: "What is Literary Genre mode?", a: "Comparing how texts use and subvert genre conventions" },
                { q: "What is General Vision and Viewpoint?", a: "Comparing the overall outlook - optimistic, pessimistic, or balanced" },
                { q: "How many texts for comparative?", a: "At least three texts must be compared" },
                { q: "What makes a good comparative point?", a: "A point that links texts with both similarities and differences supported by evidence" }
            ],
            novel: [
                { q: "What is first-person narration?", a: "Story told from 'I' perspective, limited to narrator's knowledge" },
                { q: "What is third-person omniscient?", a: "An all-knowing narrator who can access all characters' thoughts" },
                { q: "What is foreshadowing?", a: "Hints or clues about events that will happen later in the story" },
                { q: "What is stream of consciousness?", a: "A narrative technique that presents a character's continuous flow of thoughts" },
                { q: "What is a motif?", a: "A recurring element (image, idea, symbol) that develops a theme" },
                { q: "What is characterisation?", a: "The methods used by a writer to develop and reveal characters" }
            ],
            comprehension: [
                { q: "What is tone?", a: "The writer's attitude towards the subject or audience" },
                { q: "What is inference?", a: "Reading between the lines to understand implied meaning" },
                { q: "What is register?", a: "The level of formality in language (formal, informal, colloquial)" },
                { q: "What should you comment on in visual texts?", a: "Composition, colour, facial expression, body language, text, camera angle" },
                { q: "What is bias?", a: "A prejudice or one-sided view that influences the presentation of information" }
            ],
            composing: [
                { q: "What makes a strong opening?", a: "A hook that engages the reader - a question, quote, anecdote, or striking image" },
                { q: "What is PEEL structure?", a: "Point, Evidence, Explain, Link - a structure for paragraphs" },
                { q: "What makes a good speech?", a: "Rhetorical devices, direct address, repetition, varied sentence structure" },
                { q: "What is a discursive essay?", a: "An essay that presents arguments on both sides of an issue" },
                { q: "What are key features of a personal essay?", a: "Reflective tone, first person, personal anecdotes, insight and growth" }
            ],
            language: [
                { q: "What is an unreliable narrator?", a: "A narrator whose credibility is compromised, whose account cannot be fully trusted" },
                { q: "What is imagery?", a: "Descriptive language that appeals to the senses" },
                { q: "What is symbolism?", a: "Using objects, characters, or colours to represent abstract ideas" },
                { q: "What is atmosphere?", a: "The mood or feeling created by a writer through language and setting" },
                { q: "What is flashback?", a: "A scene that interrupts the present to show past events" }
            ],
            persuasion: [
                { q: "What is ethos?", a: "Persuasion through credibility and ethics of the speaker" },
                { q: "What is pathos?", a: "Persuasion through emotional appeal" },
                { q: "What is logos?", a: "Persuasion through logic and reasoning" },
                { q: "What is a rhetorical question?", a: "A question asked for effect, not expecting an answer" },
                { q: "What is anaphora?", a: "Repetition of a word or phrase at the beginning of successive clauses" },
                { q: "What is hyperbole?", a: "Deliberate exaggeration for emphasis or effect" }
            ],
            information: [
                { q: "What is objective writing?", a: "Writing that presents facts without personal opinion or bias" },
                { q: "What are discourse markers?", a: "Words that organise and connect ideas (firstly, however, in conclusion)" },
                { q: "What is technical language?", a: "Specialised vocabulary used in a particular field or subject" },
                { q: "What is the purpose of headings?", a: "To organise content and help readers navigate the text" }
            ],
            drama: [
                { q: "What are stage directions?", a: "Instructions in a script about movement, tone, lighting, or setting" },
                { q: "What is dramatic tension?", a: "The sense of anticipation and uncertainty that keeps the audience engaged" },
                { q: "What is a monologue?", a: "An extended speech by one character, may be heard by others on stage" },
                { q: "What is subtext?", a: "The underlying meaning beneath the dialogue - what characters really mean" },
                { q: "What is catharsis?", a: "The emotional release or purification experienced by the audience" }
            ]
        };

        const quizData = {
            poetry: [
                { q: "'Her eyes were diamonds' is an example of:", options: ["Simile", "Metaphor", "Personification", "Alliteration"], correct: 1, explanation: "A metaphor makes a direct comparison without using 'like' or 'as'." },
                { q: "What is the term for repeated consonant sounds at the start of words?", options: ["Assonance", "Alliteration", "Onomatopoeia", "Sibilance"], correct: 1, explanation: "Alliteration is the repetition of consonant sounds at the beginning of words." },
                { q: "A sonnet traditionally has how many lines?", options: ["10", "12", "14", "16"], correct: 2, explanation: "A sonnet has 14 lines, typically in iambic pentameter." },
                { q: "The 'turn' in a sonnet is called:", options: ["Caesura", "Volta", "Enjambment", "Couplet"], correct: 1, explanation: "The volta is the turn or shift in argument/thought in a sonnet." }
            ],
            shakespeare: [
                { q: "A speech alone on stage revealing thoughts is a:", options: ["Monologue", "Soliloquy", "Aside", "Prologue"], correct: 1, explanation: "A soliloquy is when a character speaks their thoughts aloud while alone on stage." },
                { q: "The tragic hero's fatal flaw is called:", options: ["Catharsis", "Hamartia", "Hubris", "Anagnorisis"], correct: 1, explanation: "Hamartia is the fatal flaw or error that leads to the hero's downfall." },
                { q: "When the audience knows something characters don't, it's:", options: ["Situational irony", "Verbal irony", "Dramatic irony", "Cosmic irony"], correct: 2, explanation: "Dramatic irony occurs when the audience has knowledge withheld from characters." },
                { q: "How many syllables are in a line of iambic pentameter?", options: ["8", "10", "12", "14"], correct: 1, explanation: "Iambic pentameter has 5 feet of 2 syllables each = 10 syllables." }
            ],
            comparative: [
                { q: "How many texts must be compared in the Comparative Study?", options: ["Two", "Three or more", "Four", "Five"], correct: 1, explanation: "At least three texts must be compared in the Comparative Study." },
                { q: "Which mode compares texts' optimistic or pessimistic outlooks?", options: ["Theme/Issue", "Literary Genre", "General Vision and Viewpoint", "Cultural Context"], correct: 2, explanation: "General Vision and Viewpoint examines the overall outlook of texts." },
                { q: "A comparative essay should always:", options: ["Analyse texts separately", "Link texts throughout", "Focus on one text", "Avoid quotations"], correct: 1, explanation: "Comparative essays should consistently link and compare texts, not treat them separately." }
            ],
            novel: [
                { q: "A narrator who cannot be trusted is called:", options: ["Omniscient", "Limited", "Unreliable", "Objective"], correct: 2, explanation: "An unreliable narrator's account is questionable or biased." },
                { q: "Hints about future events are called:", options: ["Flashback", "Foreshadowing", "Exposition", "Resolution"], correct: 1, explanation: "Foreshadowing gives hints or clues about what will happen later." },
                { q: "A recurring image or idea that develops a theme is a:", options: ["Symbol", "Motif", "Metaphor", "Allegory"], correct: 1, explanation: "A motif is a recurring element that reinforces themes throughout a text." },
                { q: "'Stream of consciousness' shows:", options: ["Dialogue", "Setting", "Inner thoughts flowing", "Flashbacks"], correct: 2, explanation: "Stream of consciousness presents a character's continuous flow of thoughts." }
            ],
            comprehension: [
                { q: "Reading between the lines to find implied meaning is:", options: ["Skimming", "Scanning", "Inference", "Summary"], correct: 2, explanation: "Inference is deducing meaning that is implied but not directly stated." },
                { q: "The writer's attitude towards the subject is called:", options: ["Style", "Tone", "Register", "Voice"], correct: 1, explanation: "Tone reflects the writer's attitude towards the subject or audience." },
                { q: "The level of formality in language is called:", options: ["Tone", "Style", "Register", "Dialect"], correct: 2, explanation: "Register refers to the formality level (formal, informal, colloquial)." },
                { q: "In visual texts, you should comment on:", options: ["Only the words", "Only the images", "Both words and visual elements", "Neither"], correct: 2, explanation: "Visual text analysis requires examining both textual and visual elements." }
            ],
            composing: [
                { q: "PEEL stands for:", options: ["Point, Evidence, Explain, Link", "Paragraph, Example, Evaluate, List", "Purpose, Effect, Explore, Learn", "Point, Example, Elaborate, Limit"], correct: 0, explanation: "PEEL is Point, Evidence, Explain, Link - a paragraph structure." },
                { q: "A personal essay should include:", options: ["Only facts", "Reflection and insight", "Formal language only", "Third person narration"], correct: 1, explanation: "Personal essays feature reflection, personal insight, and often first-person narration." },
                { q: "What makes an effective speech opening?", options: ["Starting with 'Hello'", "A rhetorical question or striking statement", "Listing your points", "An apology"], correct: 1, explanation: "Effective speeches open with engaging hooks like rhetorical questions or powerful statements." }
            ],
            language: [
                { q: "Language that appeals to the senses is:", options: ["Rhetoric", "Imagery", "Diction", "Syntax"], correct: 1, explanation: "Imagery is descriptive language that creates sensory experiences for the reader." },
                { q: "Using an object to represent an abstract idea is:", options: ["Metaphor", "Symbolism", "Allegory", "Motif"], correct: 1, explanation: "Symbolism uses objects, colours, or characters to represent abstract ideas." },
                { q: "A scene showing past events during the main narrative is:", options: ["Foreshadowing", "Flashback", "Exposition", "Prologue"], correct: 1, explanation: "A flashback interrupts the present narrative to show past events." }
            ],
            persuasion: [
                { q: "Persuasion through credibility and ethics is:", options: ["Pathos", "Logos", "Ethos", "Kairos"], correct: 2, explanation: "Ethos persuades by establishing the speaker's credibility and ethical character." },
                { q: "A question asked for effect, not expecting an answer:", options: ["Leading question", "Rhetorical question", "Loaded question", "Open question"], correct: 1, explanation: "Rhetorical questions are asked for effect, not to elicit an actual response." },
                { q: "Repetition at the start of successive clauses is:", options: ["Epistrophe", "Anaphora", "Chiasmus", "Parallelism"], correct: 1, explanation: "Anaphora is the repetition of words at the beginning of successive clauses." },
                { q: "Deliberate exaggeration for effect is:", options: ["Understatement", "Hyperbole", "Litotes", "Irony"], correct: 1, explanation: "Hyperbole is intentional exaggeration not meant to be taken literally." }
            ],
            information: [
                { q: "Writing that presents facts without opinion is:", options: ["Subjective", "Objective", "Persuasive", "Narrative"], correct: 1, explanation: "Objective writing presents factual information without personal bias." },
                { q: "Words like 'firstly', 'however', 'therefore' are:", options: ["Conjunctions", "Discourse markers", "Prepositions", "Interjections"], correct: 1, explanation: "Discourse markers organise and connect ideas in a text." }
            ],
            drama: [
                { q: "Instructions about movement and setting in a script are:", options: ["Dialogue", "Monologue", "Stage directions", "Asides"], correct: 2, explanation: "Stage directions give instructions about staging, movement, and delivery." },
                { q: "The emotional release experienced by the audience is:", options: ["Pathos", "Hamartia", "Catharsis", "Anagnorisis"], correct: 2, explanation: "Catharsis is the emotional purification or release felt by the audience." },
                { q: "The underlying meaning beneath dialogue is:", options: ["Context", "Subtext", "Pretext", "Intertext"], correct: 1, explanation: "Subtext is the implied meaning beneath what characters actually say." }
            ]
        };

        const formulasData = [
            // Essay Writing
            { name: "PEEL Paragraph", equation: "Point ‚Üí Evidence ‚Üí Explain ‚Üí Link", desc: "Structure for analytical paragraphs", vars: "Make a point, support with evidence, explain significance, link to question", category: "essay" },
            { name: "Essay Introduction", equation: "Hook + Context + Thesis", desc: "Opening an essay effectively", vars: "Engage reader, set context, state your argument", category: "essay" },
            { name: "Essay Conclusion", equation: "Summarise + Synthesise + Significance", desc: "Closing an essay effectively", vars: "Recap main points, bring together ideas, wider implications", category: "essay" },
            { name: "Quote Integration", equation: "Introduce + Quote + Analyse", desc: "Using quotations effectively", vars: "Set up the quote, insert quote, explain its significance", category: "essay" },
            { name: "Personal Essay", equation: "Reflect + Narrate + Insight", desc: "Structure for personal writing", vars: "Show reflection, tell story, reveal personal growth", category: "essay" },
            { name: "Speech Structure", equation: "Hook + Body + Call to Action", desc: "Effective speech organisation", vars: "Grab attention, develop argument, inspire action", category: "essay" },
            // Poetry Analysis
            { name: "Poetry Analysis (SMILE)", equation: "Structure + Meaning + Imagery + Language + Effect", desc: "Comprehensive poetry analysis framework", vars: "Examine form, interpret meaning, analyse imagery, study language, evaluate effect", category: "poetry" },
            { name: "Theme + Technique + Effect", equation: "What + How + Why", desc: "Core approach for poetry questions", vars: "What is said (theme), how it's said (technique), why (effect on reader)", category: "poetry" },
            { name: "Sound Devices", equation: "Alliteration + Assonance + Rhythm + Rhyme", desc: "Analysing sound in poetry", vars: "Examine how sound enhances meaning and mood", category: "poetry" },
            // Comparative
            { name: "Comparative Structure", equation: "Link ‚Üí Compare ‚Üí Contrast ‚Üí Conclude", desc: "Structure for comparative paragraphs", vars: "Always link texts, find similarities and differences", category: "comparative" },
            { name: "Mode of Comparison", equation: "Theme/Issue + All 3 Texts + Personal Response", desc: "Answering comparative questions", vars: "Address mode, reference all texts equally, include personal response", category: "comparative" },
            { name: "Linking Phrases", equation: "Similarly + In contrast + Likewise + However", desc: "Connecting ideas across texts", vars: "Use linking phrases to show comparison and contrast", category: "comparative" },
            // Comprehension
            { name: "Comprehension Approach", equation: "Read + Identify + Analyse + Quote", desc: "Answering comprehension questions", vars: "Read carefully, identify features, analyse effect, use evidence", category: "comprehension" },
            { name: "Visual Text Analysis", equation: "Image + Text + Context + Effect", desc: "Analysing visual media", vars: "Examine visuals, read accompanying text, consider context, discuss impact", category: "comprehension" },
            { name: "Question B Strategy", equation: "Identify Style + Apply Features + Own Voice", desc: "Answering functional writing questions", vars: "Identify text type, use appropriate conventions, maintain authenticity", category: "comprehension" },
            // Language Analysis
            { name: "Rhetorical Triangle", equation: "Ethos + Pathos + Logos", desc: "Three modes of persuasion", vars: "Ethos (credibility), Pathos (emotion), Logos (logic)", category: "language" },
            { name: "Tone Analysis", equation: "Word Choice + Sentence Structure + Effect", desc: "Identifying and analysing tone", vars: "Examine diction, look at syntax, explain impact on reader", category: "language" },
            { name: "Language of Argument", equation: "Assertion + Evidence + Explanation", desc: "Building persuasive arguments", vars: "Make claim, support with evidence, explain significance", category: "language" },
            // Drama
            { name: "Drama Analysis", equation: "Conflict + Character + Theme + Staging", desc: "Analysing dramatic texts", vars: "Central conflict, character motivations, themes, performance elements", category: "drama" },
            { name: "Character Analysis", equation: "Trait + Evidence + Development", desc: "Analysing characters in texts", vars: "Identify trait, support with quotes, show change", category: "drama" },
            { name: "Scene Analysis", equation: "Context + Action + Dialogue + Significance", desc: "Analysing key scenes", vars: "Where in play, what happens, what's said, why it matters", category: "drama" }
        ];

        const experimentsData = [
            { id: 1, title: "Poetry Close Reading", badge: "Poetry", icon: "üìù", desc: "Analyse a poem using SMILE technique" },
            { id: 2, title: "Essay Planning", badge: "Writing", icon: "üìã", desc: "Plan and structure an essay response" },
            { id: 3, title: "Comparative Analysis", badge: "Comparative", icon: "üìö", desc: "Compare themes across three texts" },
            { id: 4, title: "Speech Writing", badge: "Composing", icon: "üé§", desc: "Craft a persuasive speech" },
            { id: 5, title: "Character Study", badge: "Novel/Drama", icon: "üë§", desc: "Analyse a character's development" },
            { id: 6, title: "Visual Text Analysis", badge: "Comprehension", icon: "üñºÔ∏è", desc: "Analyse images and visual media" },
            { id: 7, title: "Dramatic Performance", badge: "Shakespeare", icon: "üé≠", desc: "Read and interpret a key scene" },
            { id: 8, title: "Creative Writing", badge: "Composing", icon: "‚úçÔ∏è", desc: "Write a short story or personal essay" }
        ];

        // ==================== STATE ====================
        let currentFlashcardIndex = 0, currentFlashcards = [];
        let currentQuizQuestion = 0, currentQuizQuestions = [], quizScore = 0;
        let selectedQuizTopic = 'all', numQuizQuestions = 5;
        let streak = parseInt(localStorage.getItem('streak') || '0');
        let xp = parseInt(localStorage.getItem('xp') || '0');

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
            createMolecules();
            initNavigation();
            initLiteraryTerms();
            initTopics();
            initFlashcards();
            initQuiz();
            initFormulas();
            initExperiments();
            initMindMaps();
            initDataTables();
            initGlossary();
            initExamCountdown();
            loadProgress();
            updateStats();
            initDashboard();
            
            // Request notification permission for Pomodoro
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });

        function createMolecules() {
            const container = document.getElementById('bgMolecules');
            for (let i = 0; i < 12; i++) {
                const mol = document.createElement('div');
                mol.className = 'molecule';
                mol.style.width = Math.random() * 100 + 50 + 'px';
                mol.style.height = mol.style.width;
                mol.style.left = Math.random() * 100 + '%';
                mol.style.top = Math.random() * 100 + '%';
                mol.style.animationDelay = Math.random() * 20 + 's';
                container.appendChild(mol);
            }
        }

        function initNavigation() {
            const navBtns = document.querySelectorAll('.nav-btn');
            const sections = document.querySelectorAll('.section');
            navBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const sectionId = btn.dataset.section;
                    navBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    sections.forEach(s => s.classList.remove('active'));
                    document.getElementById(sectionId).classList.add('active');
                    document.getElementById('topicView').classList.remove('active');
                    document.getElementById('topicsGrid').style.display = 'grid';
                });
            });
            document.querySelectorAll('.quick-action').forEach(action => {
                action.addEventListener('click', () => {
                    document.querySelector(`[data-section="${action.dataset.goto}"]`).click();
                });
            });
        }

        function initDashboard() {
            const recentTopics = document.getElementById('recentTopics');
            const recent = topics.slice(0, 3);
            recentTopics.innerHTML = recent.map(topic => `
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: var(--bg-tertiary); border-radius: var(--radius-sm); margin-bottom: 0.5rem; cursor: pointer;" onclick="goToTopic('${topic.id}')">
                    <span style="font-size: 1.5rem;">${topic.icon}</span>
                    <div style="flex: 1;"><div style="font-weight: 500;">${topic.title}</div><div style="font-size: 0.8rem; color: var(--text-secondary);">${topic.progress || 0}% complete</div></div>
                    <span style="color: var(--accent-cyan);">‚Üí</span>
                </div>
            `).join('');
            updateProgressDisplay();
        }

        function goToTopic(topicId) {
            document.querySelector('[data-section="topics"]').click();
            setTimeout(() => showTopicContent(topicId), 100);
        }

        // ==================== LITERARY TERMS ====================
        const literaryTerms = {
            poetry: [
                { term: 'Metaphor', def: 'A direct comparison between two things without using "like" or "as".', example: '"Life is a journey"' },
                { term: 'Simile', def: 'A comparison using "like" or "as".', example: '"Her eyes sparkled like stars"' },
                { term: 'Personification', def: 'Giving human qualities to non-human things.', example: '"The wind whispered through the trees"' },
                { term: 'Alliteration', def: 'Repetition of consonant sounds at the beginning of words.', example: '"Peter Piper picked a peck"' },
                { term: 'Assonance', def: 'Repetition of vowel sounds within words.', example: '"The rain in Spain falls mainly on the plain"' },
                { term: 'Onomatopoeia', def: 'Words that imitate sounds.', example: '"buzz", "crash", "whisper"' },
                { term: 'Enjambment', def: 'When a sentence continues from one line to the next without punctuation.', example: 'Running over line breaks' },
                { term: 'Caesura', def: 'A pause in the middle of a line of poetry.', example: '"To be, || or not to be"' },
                { term: 'Volta', def: 'A turn or shift in thought in a poem, especially in sonnets.', example: 'Often at line 9 in a sonnet' },
                { term: 'Imagery', def: 'Descriptive language that appeals to the senses.', example: 'Visual, auditory, tactile imagery' },
                { term: 'Symbolism', def: 'Using objects to represent abstract ideas.', example: 'A dove symbolising peace' },
                { term: 'Oxymoron', def: 'Two contradictory words placed together.', example: '"bitter sweet", "living death"' }
            ],
            drama: [
                { term: 'Soliloquy', def: 'A speech where a character speaks thoughts aloud, alone on stage.', example: '"To be or not to be" - Hamlet' },
                { term: 'Aside', def: 'A remark heard by the audience but not by other characters.', example: 'Breaking the fourth wall' },
                { term: 'Monologue', def: 'An extended speech by one character, others may be present.', example: 'Different from soliloquy' },
                { term: 'Dramatic Irony', def: 'When the audience knows something characters do not.', example: 'Audience knows the killer\'s identity' },
                { term: 'Tragic Hero', def: 'A protagonist of high status with a fatal flaw leading to downfall.', example: 'Macbeth, Hamlet, Othello' },
                { term: 'Hamartia', def: 'The tragic hero\'s fatal flaw or error in judgement.', example: 'Macbeth\'s ambition' },
                { term: 'Catharsis', def: 'Emotional release or purification experienced by the audience.', example: 'Feeling cleansed after tragedy' },
                { term: 'Stage Directions', def: 'Instructions about movement, tone, lighting, or setting.', example: '[Enter HAMLET, reading]' },
                { term: 'Subtext', def: 'The underlying meaning beneath the dialogue.', example: 'What characters really mean' },
                { term: 'Anagnorisis', def: 'The moment of critical discovery or recognition.', example: 'Oedipus learns the truth' }
            ],
            prose: [
                { term: 'Narrator', def: 'The voice telling the story.', example: 'First person, third person, omniscient' },
                { term: 'Unreliable Narrator', def: 'A narrator whose account cannot be fully trusted.', example: 'Biased or limited perspective' },
                { term: 'Stream of Consciousness', def: 'Narrative presenting continuous flow of thoughts.', example: 'James Joyce\'s style' },
                { term: 'Foreshadowing', def: 'Hints or clues about events that will happen later.', example: 'Early warning signs in plot' },
                { term: 'Flashback', def: 'A scene that interrupts the present to show past events.', example: 'Memory sequences' },
                { term: 'Motif', def: 'A recurring element that develops a theme.', example: 'Repeated images or ideas' },
                { term: 'Characterisation', def: 'Methods used to develop and reveal characters.', example: 'Direct and indirect methods' },
                { term: 'Setting', def: 'The time and place of the narrative.', example: 'Creates atmosphere and context' },
                { term: 'Point of View', def: 'The perspective from which the story is told.', example: 'First, second, or third person' },
                { term: 'Pathetic Fallacy', def: 'Nature reflecting human emotions.', example: 'Storms during emotional scenes' }
            ],
            rhetoric: [
                { term: 'Ethos', def: 'Persuasion through credibility and ethics.', example: '"As a doctor, I can tell you..."' },
                { term: 'Pathos', def: 'Persuasion through emotional appeal.', example: 'Stories that evoke sympathy' },
                { term: 'Logos', def: 'Persuasion through logic and reasoning.', example: 'Statistics and evidence' },
                { term: 'Rhetorical Question', def: 'A question asked for effect, not expecting an answer.', example: '"Is this what we want?"' },
                { term: 'Anaphora', def: 'Repetition at the beginning of successive clauses.', example: '"I have a dream..."' },
                { term: 'Hyperbole', def: 'Deliberate exaggeration for emphasis.', example: '"I\'ve told you a million times"' },
                { term: 'Tricolon', def: 'Three parallel words, phrases, or clauses.', example: '"Veni, vidi, vici"' },
                { term: 'Antithesis', def: 'Contrasting ideas in balanced phrases.', example: '"It was the best of times, it was the worst of times"' },
                { term: 'Emotive Language', def: 'Words chosen to evoke emotional responses.', example: '"Innocent children suffered"' },
                { term: 'Inclusive Language', def: 'Using "we" and "our" to create unity.', example: '"We must work together"' }
            ],
            language: [
                { term: 'Tone', def: 'The writer\'s attitude towards subject or audience.', example: 'Serious, humorous, ironic' },
                { term: 'Register', def: 'The level of formality in language.', example: 'Formal, informal, colloquial' },
                { term: 'Diction', def: 'Word choice and vocabulary selection.', example: 'Simple vs complex words' },
                { term: 'Syntax', def: 'Sentence structure and arrangement.', example: 'Short sentences for impact' },
                { term: 'Juxtaposition', def: 'Placing contrasting elements side by side.', example: 'Light vs dark imagery' },
                { term: 'Irony', def: 'When meaning is opposite to what is said.', example: '"What lovely weather" in a storm' },
                { term: 'Sarcasm', def: 'Mocking or contemptuous irony.', example: '"Oh, that\'s just great"' },
                { term: 'Euphemism', def: 'A mild word substituted for a harsh one.', example: '"Passed away" for "died"' },
                { term: 'Colloquialism', def: 'Informal everyday language.', example: '"Gonna", "wanna", slang' },
                { term: 'Connotation', def: 'The implied meaning beyond literal definition.', example: '"Home" vs "house"' }
            ]
        };

        let currentLitCategory = 'poetry';

        function initLiteraryTerms() {
            renderLiteraryTerms('poetry');
            document.querySelectorAll('[data-litcat]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-litcat]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderLiteraryTerms(btn.dataset.litcat);
                });
            });
        }

        function renderLiteraryTerms(category) {
            currentLitCategory = category;
            const container = document.getElementById('literaryTermsContent');
            const terms = literaryTerms[category] || [];
            container.innerHTML = terms.map(t => `
                <div class="card" style="padding: 1rem; cursor: pointer; transition: all 0.3s;" onclick="showTermDetail('${t.term.replace(/'/g, "\\'")}', '${t.def.replace(/'/g, "\\'")}', '${t.example.replace(/'/g, "\\'")}')">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 0.5rem;">${t.term}</h4>
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 0.5rem;">${t.def}</p>
                    <p style="color: var(--text-muted); font-size: 0.8rem; font-style: italic;">Example: ${t.example}</p>
                </div>
            `).join('');
        }

        function showTermDetail(term, def, example) {
            const modal = document.getElementById('elementModal');
            const body = document.getElementById('elementModalBody');
            body.innerHTML = `
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <h2 style="color: var(--accent-cyan); font-size: 1.75rem;">${term}</h2>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--text-muted); margin-bottom: 0.5rem;">Definition</h4>
                    <p style="color: var(--text-primary); font-size: 1.1rem; line-height: 1.6;">${def}</p>
                </div>
                <div style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); border-left: 3px solid var(--accent-cyan);">
                    <h4 style="color: var(--text-muted); margin-bottom: 0.5rem;">Example</h4>
                    <p style="color: var(--accent-green); font-style: italic;">${example}</p>
                </div>`;
            modal.classList.add('active');
        }

        document.getElementById('closeModal').addEventListener('click', () => document.getElementById('elementModal').classList.remove('active'));
        document.getElementById('elementModal').addEventListener('click', (e) => { if (e.target.id === 'elementModal') document.getElementById('elementModal').classList.remove('active'); });

        // ==================== TOPICS ====================
        function initTopics() {
            const grid = document.getElementById('topicsGrid');
            grid.innerHTML = topics.map(topic => `
                <div class="card topic-card" data-topic="${topic.id}">
                    <div class="topic-header"><div class="topic-icon">${topic.icon}</div><span class="topic-progress">${topic.progress}%</span></div>
                    <h3 class="topic-title">${topic.title}</h3>
                    <p class="topic-desc">${topic.desc}</p>
                    <div class="topic-stats"><span class="topic-stat">üìñ ${topic.lessons} lessons</span><span class="topic-stat">‚ùì ${topic.questions} questions</span></div>
                </div>
            `).join('');
            document.querySelectorAll('.topic-card').forEach(card => { card.addEventListener('click', () => showTopicContent(card.dataset.topic)); });
            document.getElementById('backToTopics').addEventListener('click', () => { document.getElementById('topicView').classList.remove('active'); document.getElementById('topicsGrid').style.display = 'grid'; });
        }

        function showTopicContent(topicId) {
            const topic = topics.find(t => t.id === topicId);
            if (!topic) return;
            document.getElementById('topicsGrid').style.display = 'none';
            document.getElementById('topicContent').innerHTML = topic.content;
            document.getElementById('topicView').classList.add('active');
            
            // Update progress - viewing a topic gives at least 25% progress
            const currentProgress = topic.progress || 0;
            if (currentProgress < 25) {
                saveProgress(topicId, 25);
            }
            addXP(10);
            
            // Refresh the topics grid to show updated progress
            initTopics();
        }

        // ==================== FLASHCARDS ====================
        function initFlashcards() {
            const flashcard = document.getElementById('flashcard');
            flashcard.addEventListener('click', () => { flashcard.classList.toggle('flipped'); if (flashcard.classList.contains('flipped')) document.getElementById('ratingButtons').style.display = 'flex'; });
            document.getElementById('startFlashcards').addEventListener('click', startFlashcardSession);
            document.getElementById('prevCard').addEventListener('click', prevFlashcard);
            document.getElementById('nextCard').addEventListener('click', nextFlashcard);
            document.querySelectorAll('.rating-btn').forEach(btn => { btn.addEventListener('click', () => { 
                addXP(btn.classList.contains('easy') ? 15 : btn.classList.contains('good') ? 10 : 5); 
                
                // Track flashcard progress
                const currentTopic = document.getElementById('flashcardTopic').value;
                if (currentTopic !== 'all') {
                    const topic = topics.find(t => t.id === currentTopic);
                    if (topic) {
                        const newProgress = Math.min(100, (topic.progress || 0) + 5);
                        saveProgress(currentTopic, newProgress);
                    }
                }
                
                nextFlashcard(); 
            }); });
        }

        function startFlashcardSession() {
            const topic = document.getElementById('flashcardTopic').value;
            currentFlashcards = topic === 'all' ? Object.values(flashcardsData).flat() : (flashcardsData[topic] || []);
            currentFlashcards = currentFlashcards.sort(() => Math.random() - 0.5);
            currentFlashcardIndex = 0;
            if (currentFlashcards.length > 0) { showFlashcard(); document.getElementById('prevCard').disabled = true; document.getElementById('nextCard').disabled = false; }
        }

        function showFlashcard() {
            const card = currentFlashcards[currentFlashcardIndex];
            document.getElementById('flashcardQuestion').textContent = card.q;
            document.getElementById('flashcardAnswer').textContent = card.a;
            document.getElementById('currentCard').textContent = currentFlashcardIndex + 1;
            document.getElementById('totalCards').textContent = currentFlashcards.length;
            document.getElementById('flashcard').classList.remove('flipped');
            document.getElementById('ratingButtons').style.display = 'none';
        }

        function nextFlashcard() { if (currentFlashcardIndex < currentFlashcards.length - 1) { currentFlashcardIndex++; showFlashcard(); document.getElementById('prevCard').disabled = false; } if (currentFlashcardIndex === currentFlashcards.length - 1) document.getElementById('nextCard').disabled = true; }
        function prevFlashcard() { if (currentFlashcardIndex > 0) { currentFlashcardIndex--; showFlashcard(); document.getElementById('nextCard').disabled = false; } if (currentFlashcardIndex === 0) document.getElementById('prevCard').disabled = true; }

        // ==================== QUIZ ====================
        function initQuiz() {
            const topicOptions = document.getElementById('quizTopicOptions');
            topicOptions.innerHTML = `<div class="quiz-option selected" data-topic="all">All Topics</div>` + topics.filter(t => quizData[t.id]).map(topic => `<div class="quiz-option" data-topic="${topic.id}">${topic.icon} ${topic.title}</div>`).join('');
            topicOptions.addEventListener('click', (e) => { if (e.target.classList.contains('quiz-option')) { topicOptions.querySelectorAll('.quiz-option').forEach(o => o.classList.remove('selected')); e.target.classList.add('selected'); selectedQuizTopic = e.target.dataset.topic; } });
            document.querySelectorAll('[data-questions]').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('[data-questions]').forEach(b => b.classList.remove('selected')); btn.classList.add('selected'); numQuizQuestions = parseInt(btn.dataset.questions); }); });
            document.getElementById('startQuiz').addEventListener('click', startQuiz);
            document.getElementById('quitQuiz').addEventListener('click', quitQuiz);
            document.getElementById('nextQuestion').addEventListener('click', nextQuizQuestion);
            document.getElementById('retakeQuiz').addEventListener('click', () => { document.getElementById('quizResults').style.display = 'none'; document.getElementById('quizSetup').style.display = 'block'; });
        }

        function startQuiz() {
            currentQuizQuestions = selectedQuizTopic === 'all' ? Object.values(quizData).flat() : (quizData[selectedQuizTopic] || []);
            currentQuizQuestions = currentQuizQuestions.sort(() => Math.random() - 0.5).slice(0, numQuizQuestions);
            currentQuizQuestion = 0; quizScore = 0;
            document.getElementById('quizSetup').style.display = 'none';
            document.getElementById('quizArea').style.display = 'block';
            document.getElementById('quizResults').style.display = 'none';
            showQuizQuestion();
        }

        function showQuizQuestion() {
            const q = currentQuizQuestions[currentQuizQuestion], total = currentQuizQuestions.length;
            document.getElementById('quizQuestionNum').textContent = `${currentQuizQuestion + 1}/${total}`;
            document.getElementById('quizProgressBar').style.width = `${((currentQuizQuestion + 1) / total) * 100}%`;
            document.getElementById('quizScore').textContent = `Score: ${quizScore}`;
            const letters = ['A', 'B', 'C', 'D'];
            document.getElementById('quizQuestionArea').innerHTML = `<div class="question-number">Question ${currentQuizQuestion + 1}</div><div class="question-text">${q.q}</div><div class="answers">${q.options.map((opt, i) => `<div class="answer-option" data-index="${i}"><span class="answer-letter">${letters[i]}</span><span>${opt}</span></div>`).join('')}</div>`;
            document.getElementById('nextQuestion').style.display = 'none';
            document.querySelectorAll('.answer-option').forEach(opt => { opt.addEventListener('click', () => selectAnswer(parseInt(opt.dataset.index))); });
        }

        function selectAnswer(index) {
            const q = currentQuizQuestions[currentQuizQuestion];
            document.querySelectorAll('.answer-option').forEach(opt => {
                opt.classList.add('disabled'); opt.style.pointerEvents = 'none';
                if (parseInt(opt.dataset.index) === q.correct) opt.classList.add('correct');
                else if (parseInt(opt.dataset.index) === index && index !== q.correct) opt.classList.add('incorrect');
            });
            if (index === q.correct) { quizScore++; addXP(20); }
            document.getElementById('quizQuestionArea').innerHTML += `<div class="explanation"><div class="explanation-title">üí° Explanation</div><p>${q.explanation}</p></div>`;
            document.getElementById('quizScore').textContent = `Score: ${quizScore}`;
            document.getElementById('nextQuestion').style.display = 'block';
            document.getElementById('nextQuestion').textContent = currentQuizQuestion < currentQuizQuestions.length - 1 ? 'Next Question ‚Üí' : 'See Results';
        }

        function nextQuizQuestion() { currentQuizQuestion++; if (currentQuizQuestion < currentQuizQuestions.length) showQuizQuestion(); else showQuizResults(); }
        function showQuizResults() {
            const percent = Math.round((quizScore / currentQuizQuestions.length) * 100);
            document.getElementById('quizArea').style.display = 'none';
            document.getElementById('quizResults').style.display = 'block';
            document.getElementById('finalScore').textContent = `${percent}%`;
            document.getElementById('finalScoreLabel').textContent = `${quizScore} out of ${currentQuizQuestions.length} correct`;
            addXP(percent >= 80 ? 50 : percent >= 60 ? 30 : 10);
            
            // Update topic progress based on quiz performance
            if (selectedQuizTopic !== 'all') {
                const topic = topics.find(t => t.id === selectedQuizTopic);
                if (topic) {
                    const newProgress = Math.min(100, Math.max(topic.progress || 0, percent >= 80 ? 100 : percent >= 60 ? 75 : 50));
                    saveProgress(selectedQuizTopic, newProgress);
                    initTopics();
                }
            }
        }
        function quitQuiz() { document.getElementById('quizArea').style.display = 'none'; document.getElementById('quizSetup').style.display = 'block'; }

        // ==================== WRITING TOOLS ====================
        function countWords() {
            const text = document.getElementById('wordCountText').value.trim();
            if (!text) { document.getElementById('wordCountResult').textContent = '0'; document.getElementById('wordCountDetails').textContent = ''; return; }
            const words = text.split(/\s+/).filter(w => w.length > 0).length;
            const chars = text.length;
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0).length;
            const paragraphs = text.split(/\n\n+/).filter(p => p.trim().length > 0).length;
            document.getElementById('wordCountResult').textContent = words + ' words';
            document.getElementById('wordCountDetails').innerHTML = `Characters: ${chars} | Sentences: ${sentences} | Paragraphs: ${paragraphs}`;
        }
        let essayTimerInterval = null;
        function startEssayTimer() {
            if (essayTimerInterval) clearInterval(essayTimerInterval);
            let minutes = parseInt(document.getElementById('essayTimeLimit').value) || 45;
            let seconds = minutes * 60;
            const display = document.getElementById('essayTimerResult');
            essayTimerInterval = setInterval(() => {
                const m = Math.floor(seconds / 60), s = seconds % 60;
                display.textContent = `${m}:${s.toString().padStart(2, '0')}`;
                if (seconds <= 0) { clearInterval(essayTimerInterval); display.textContent = 'Time up!'; if ('Notification' in window && Notification.permission === 'granted') new Notification('Essay Timer', { body: 'Time is up!' }); }
                seconds--;
            }, 1000);
        }
        function stopEssayTimer() { if (essayTimerInterval) { clearInterval(essayTimerInterval); essayTimerInterval = null; } }
        function calculateReadingTime() {
            const words = parseInt(document.getElementById('readingWordCount').value) || 0;
            const wpm = parseInt(document.getElementById('readingSpeed').value) || 200;
            if (words > 0 && wpm > 0) {
                const mins = Math.ceil(words / wpm);
                document.getElementById('readingTimeResult').textContent = `${mins} min${mins > 1 ? 's' : ''}`;
            }
        }
        function showEssayStructure() {
            const type = document.getElementById('essayType').value;
            const structures = {
                personal: '<strong>Personal Essay:</strong><br>1. Opening hook (anecdote/moment)<br>2. Set the scene<br>3. Building tension/conflict<br>4. Climax/turning point<br>5. Reflection & insight<br>6. Conclusion (wider meaning)',
                discursive: '<strong>Discursive Essay:</strong><br>1. Introduction + thesis<br>2. Point 1 (for)<br>3. Point 2 (for)<br>4. Point 3 (against)<br>5. Point 4 (against)<br>6. Balanced evaluation<br>7. Conclusion',
                short: '<strong>Short Story:</strong><br>1. Opening hook<br>2. Character/setting introduction<br>3. Rising action<br>4. Climax<br>5. Falling action<br>6. Resolution/twist',
                speech: '<strong>Speech:</strong><br>1. Attention-grabbing opening<br>2. State your position<br>3. Main argument 1<br>4. Main argument 2<br>5. Address counter-arguments<br>6. Call to action',
                article: '<strong>Article:</strong><br>1. Catchy headline + opening<br>2. Context/background<br>3. Main point 1<br>4. Main point 2<br>5. Expert opinion/stats<br>6. Conclusion'
            };
            document.getElementById('essayStructureResult').innerHTML = structures[type] || '';
        }
        function calculatePCLM() {
            const p = parseInt(document.getElementById('pclmP').value) || 0;
            const c = parseInt(document.getElementById('pclmC').value) || 0;
            const l = parseInt(document.getElementById('pclmL').value) || 0;
            const m = parseInt(document.getElementById('pclmM').value) || 0;
            const avg = ((p + c + l + m) / 4) * 10;
            document.getElementById('pclmResult').textContent = Math.round(avg) + '%';
        }
        function showTransitions() {
            const cat = document.getElementById('transitionCategory').value;
            const transitions = {
                addition: 'Furthermore, Moreover, In addition, Additionally, Also, Besides, What is more, Not only... but also',
                contrast: 'However, Nevertheless, On the other hand, Conversely, In contrast, Although, Despite, Yet, While',
                cause: 'Therefore, Consequently, As a result, Thus, Hence, Because of this, For this reason, Accordingly',
                sequence: 'Firstly, Secondly, Next, Then, Subsequently, Following this, Finally, In conclusion',
                conclusion: 'In conclusion, To summarise, Ultimately, In essence, To conclude, All things considered, On balance',
                emphasis: 'Indeed, In fact, Significantly, Notably, Crucially, Most importantly, Above all, It is worth noting'
            };
            document.getElementById('transitionsList').innerHTML = transitions[cat] ? transitions[cat].split(', ').map(t => `<span style="display:inline-block; background:var(--bg-tertiary); padding:0.25rem 0.5rem; border-radius:4px; margin:0.25rem;">${t}</span>`).join('') : '';
        }
        // Initialize transition words on page load
        document.addEventListener('DOMContentLoaded', () => { showTransitions(); });

        // ==================== FORMULAS ====================
        function initFormulas() { renderFormulas('all'); document.querySelectorAll('.formula-cat-btn').forEach(btn => { btn.addEventListener('click', () => { document.querySelectorAll('.formula-cat-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); renderFormulas(btn.dataset.category); }); }); }
        function renderFormulas(category) { const list = document.getElementById('formulaList'), filtered = category === 'all' ? formulasData : formulasData.filter(f => f.category === category); list.innerHTML = filtered.map(f => `<div class="formula-item"><div class="formula-name">${f.name}</div><div class="formula-equation">${f.equation}</div><div class="formula-desc">${f.desc}</div><div class="formula-vars">${f.vars}</div></div>`).join(''); }

        // ==================== EXPERIMENTS ====================
        function initExperiments() { const grid = document.getElementById('experimentsGrid'); grid.innerHTML = experimentsData.map(exp => `<div class="card experiment-card"><span class="experiment-badge">${exp.badge}</span><div class="experiment-image">${exp.icon}</div><h3 class="topic-title">${exp.title}</h3><p class="topic-desc">${exp.desc}</p><button class="btn btn-secondary" style="width: 100%; margin-top: 1rem;" onclick="alert('Full experiment guide coming soon!')">View Guide</button></div>`).join(''); }

        // ==================== MIND MAPS ====================
        const mindmapData = {
            poetry: {
                center: { label: 'Poetry Analysis', color: '#00d4ff' },
                nodes: [
                    { id: 'techniques', label: 'Poetic Techniques', color: '#ff006e', desc: 'Literary devices used by poets to create meaning and effect.' },
                    { id: 'metaphor', label: 'Metaphor', color: '#ff006e', parent: 'techniques', desc: 'Direct comparison without using like/as.' },
                    { id: 'simile', label: 'Simile', color: '#ff006e', parent: 'techniques', desc: 'Comparison using like or as.' },
                    { id: 'imagery', label: 'Imagery', color: '#ff006e', parent: 'techniques', desc: 'Language appealing to the senses.' },
                    { id: 'structure', label: 'Structure', color: '#00ff88', desc: 'How the poem is organised and arranged.' },
                    { id: 'stanza', label: 'Stanza Form', color: '#00ff88', parent: 'structure', desc: 'Grouping of lines: couplet, quatrain, etc.' },
                    { id: 'rhyme', label: 'Rhyme Scheme', color: '#00ff88', parent: 'structure', desc: 'Pattern of rhyming words (ABAB, ABBA).' },
                    { id: 'sound', label: 'Sound Devices', color: '#ffbe0b', desc: 'Techniques that create auditory effects.' },
                    { id: 'alliteration', label: 'Alliteration', color: '#ffbe0b', parent: 'sound', desc: 'Repeated consonant sounds.' },
                    { id: 'assonance', label: 'Assonance', color: '#ffbe0b', parent: 'sound', desc: 'Repeated vowel sounds.' },
                    { id: 'analysis', label: 'Analysis Approach', color: '#8338ec', desc: 'SMILE: Structure, Meaning, Imagery, Language, Effect.' },
                    { id: 'theme', label: 'Theme', color: '#8338ec', parent: 'analysis', desc: 'Central idea or message of the poem.' }
                ]
            },
            shakespeare: {
                center: { label: 'Shakespeare', color: '#00d4ff' },
                nodes: [
                    { id: 'tragedy', label: 'Tragedy Elements', color: '#ff006e', desc: 'Features of Shakespearean tragedy.' },
                    { id: 'hero', label: 'Tragic Hero', color: '#ff006e', parent: 'tragedy', desc: 'Protagonist of high status with fatal flaw.' },
                    { id: 'hamartia', label: 'Hamartia', color: '#ff006e', parent: 'tragedy', desc: 'The fatal flaw causing downfall.' },
                    { id: 'catharsis', label: 'Catharsis', color: '#ff006e', parent: 'tragedy', desc: 'Emotional release for the audience.' },
                    { id: 'techniques', label: 'Dramatic Techniques', color: '#00ff88', desc: 'Stagecraft and dramatic devices used.' },
                    { id: 'soliloquy', label: 'Soliloquy', color: '#00ff88', parent: 'techniques', desc: 'Character speaks thoughts aloud alone.' },
                    { id: 'aside', label: 'Aside', color: '#00ff88', parent: 'techniques', desc: 'Remark heard by audience not characters.' },
                    { id: 'irony', label: 'Dramatic Irony', color: '#00ff88', parent: 'techniques', desc: 'Audience knows more than characters.' },
                    { id: 'language', label: 'Language Features', color: '#8338ec', desc: 'Distinctive aspects of Shakespeare\'s language.' },
                    { id: 'iambic', label: 'Iambic Pentameter', color: '#8338ec', parent: 'language', desc: 'Five pairs of unstressed/stressed syllables.' },
                    { id: 'prose', label: 'Prose vs Verse', color: '#8338ec', parent: 'language', desc: 'Prose for common folk, verse for nobility.' }
                ]
            },
            comparative: {
                center: { label: 'Comparative Study', color: '#00d4ff' },
                nodes: [
                    { id: 'modes', label: 'Modes of Comparison', color: '#ff006e', desc: 'Three lenses through which to compare texts.' },
                    { id: 'theme', label: 'Theme/Issue', color: '#ff006e', parent: 'modes', desc: 'Compare how texts explore same themes.' },
                    { id: 'genre', label: 'Literary Genre', color: '#ff006e', parent: 'modes', desc: 'How texts use genre conventions.' },
                    { id: 'vision', label: 'General Vision', color: '#ff006e', parent: 'modes', desc: 'Optimistic, pessimistic, or balanced outlook.' },
                    { id: 'structure', label: 'Essay Structure', color: '#00ff88', desc: 'How to organise comparative responses.' },
                    { id: 'linking', label: 'Constant Linking', color: '#00ff88', parent: 'structure', desc: 'Never analyse texts in isolation.' },
                    { id: 'evidence', label: 'Evidence', color: '#00ff88', parent: 'structure', desc: 'Quotes and examples from all three texts.' },
                    { id: 'texts', label: 'Text Types', color: '#8338ec', desc: 'Types of texts for comparative study.' },
                    { id: 'novel', label: 'Novel', color: '#8338ec', parent: 'texts', desc: 'Extended prose narrative fiction.' },
                    { id: 'play', label: 'Play/Drama', color: '#8338ec', parent: 'texts', desc: 'Written for performance on stage.' },
                    { id: 'film', label: 'Film', color: '#8338ec', parent: 'texts', desc: 'Visual medium with cinematic techniques.' }
                ]
            },
            novel: {
                center: { label: 'Single Text (Novel)', color: '#00d4ff' },
                nodes: [
                    { id: 'narrative', label: 'Narrative Voice', color: '#ff006e', desc: 'Who tells the story and how.' },
                    { id: 'first', label: 'First Person', color: '#ff006e', parent: 'narrative', desc: 'I/we narrator, limited perspective.' },
                    { id: 'third', label: 'Third Person', color: '#ff006e', parent: 'narrative', desc: 'He/she, can be limited or omniscient.' },
                    { id: 'unreliable', label: 'Unreliable Narrator', color: '#ff006e', parent: 'narrative', desc: 'Narrator whose account is questionable.' },
                    { id: 'elements', label: 'Novel Elements', color: '#00ff88', desc: 'Key components of prose fiction.' },
                    { id: 'plot', label: 'Plot Structure', color: '#00ff88', parent: 'elements', desc: 'Exposition, rising action, climax, resolution.' },
                    { id: 'character', label: 'Characterisation', color: '#00ff88', parent: 'elements', desc: 'How characters are developed.' },
                    { id: 'setting', label: 'Setting', color: '#00ff88', parent: 'elements', desc: 'Time, place, atmosphere.' },
                    { id: 'techniques', label: 'Techniques', color: '#8338ec', desc: 'Literary devices in prose.' },
                    { id: 'foreshadow', label: 'Foreshadowing', color: '#8338ec', parent: 'techniques', desc: 'Hints about future events.' },
                    { id: 'flashback', label: 'Flashback', color: '#8338ec', parent: 'techniques', desc: 'Scene showing past events.' }
                ]
            },
            composing: {
                center: { label: 'Composing', color: '#00d4ff' },
                nodes: [
                    { id: 'types', label: 'Essay Types', color: '#ff006e', desc: 'Different forms of composition.' },
                    { id: 'personal', label: 'Personal Essay', color: '#ff006e', parent: 'types', desc: 'Reflective, first person, insight.' },
                    { id: 'discursive', label: 'Discursive', color: '#ff006e', parent: 'types', desc: 'Balanced argument on an issue.' },
                    { id: 'narrative', label: 'Narrative', color: '#ff006e', parent: 'types', desc: 'Story with plot and characters.' },
                    { id: 'speech', label: 'Speech', color: '#ff006e', parent: 'types', desc: 'Persuasive, direct address.' },
                    { id: 'structure', label: 'Structure', color: '#00ff88', desc: 'Organisation of your writing.' },
                    { id: 'intro', label: 'Introduction', color: '#00ff88', parent: 'structure', desc: 'Hook, context, thesis.' },
                    { id: 'body', label: 'Body Paragraphs', color: '#00ff88', parent: 'structure', desc: 'PEEL structure, development.' },
                    { id: 'conclusion', label: 'Conclusion', color: '#00ff88', parent: 'structure', desc: 'Summarise, synthesise, significance.' },
                    { id: 'language', label: 'Language & Style', color: '#8338ec', desc: 'Register, tone, vocabulary choices.' }
                ]
            },
            comprehension: {
                center: { label: 'Comprehension', color: '#00d4ff' },
                nodes: [
                    { id: 'textTypes', label: 'Text Types', color: '#ff006e', desc: 'Types of texts you may encounter.' },
                    { id: 'narrative', label: 'Narrative', color: '#ff006e', parent: 'textTypes', desc: 'Stories, biographies, memoirs.' },
                    { id: 'argument', label: 'Argumentative', color: '#ff006e', parent: 'textTypes', desc: 'Opinion pieces, editorials.' },
                    { id: 'visual', label: 'Visual', color: '#ff006e', parent: 'textTypes', desc: 'Images, advertisements, posters.' },
                    { id: 'skills', label: 'Key Skills', color: '#00ff88', desc: 'Abilities needed for comprehension.' },
                    { id: 'inference', label: 'Inference', color: '#00ff88', parent: 'skills', desc: 'Reading between the lines.' },
                    { id: 'analysis', label: 'Analysis', color: '#00ff88', parent: 'skills', desc: 'Examining language and effect.' },
                    { id: 'features', label: 'Language Features', color: '#8338ec', desc: 'What to identify and discuss.' },
                    { id: 'tone', label: 'Tone', color: '#8338ec', parent: 'features', desc: 'Writer\'s attitude.' },
                    { id: 'register', label: 'Register', color: '#8338ec', parent: 'features', desc: 'Level of formality.' }
                ]
            },
            persuasion: {
                center: { label: 'Language of Argument', color: '#00d4ff' },
                nodes: [
                    { id: 'appeals', label: 'Rhetorical Appeals', color: '#ff006e', desc: 'Three modes of persuasion.' },
                    { id: 'ethos', label: 'Ethos', color: '#ff006e', parent: 'appeals', desc: 'Appeal to credibility/ethics.' },
                    { id: 'pathos', label: 'Pathos', color: '#ff006e', parent: 'appeals', desc: 'Appeal to emotion.' },
                    { id: 'logos', label: 'Logos', color: '#ff006e', parent: 'appeals', desc: 'Appeal to logic/reason.' },
                    { id: 'techniques', label: 'Techniques', color: '#00ff88', desc: 'Persuasive devices.' },
                    { id: 'rhetorical', label: 'Rhetorical Question', color: '#00ff88', parent: 'techniques', desc: 'Question for effect.' },
                    { id: 'repetition', label: 'Repetition', color: '#00ff88', parent: 'techniques', desc: 'Emphasis through repeating.' },
                    { id: 'tricolon', label: 'Tricolon', color: '#00ff88', parent: 'techniques', desc: 'Rule of three.' },
                    { id: 'structure', label: 'Argument Structure', color: '#8338ec', desc: 'How arguments are built.' },
                    { id: 'claim', label: 'Claim', color: '#8338ec', parent: 'structure', desc: 'Main argument statement.' },
                    { id: 'evidence', label: 'Evidence', color: '#8338ec', parent: 'structure', desc: 'Supporting facts and examples.' }
                ]
            },
            drama: {
                center: { label: 'Drama', color: '#00d4ff' },
                nodes: [
                    { id: 'elements', label: 'Drama Elements', color: '#ff006e', desc: 'Key components of plays.' },
                    { id: 'dialogue', label: 'Dialogue', color: '#ff006e', parent: 'elements', desc: 'Speech between characters.' },
                    { id: 'stage', label: 'Stage Directions', color: '#ff006e', parent: 'elements', desc: 'Instructions for performance.' },
                    { id: 'conflict', label: 'Conflict', color: '#ff006e', parent: 'elements', desc: 'Central tension driving plot.' },
                    { id: 'techniques', label: 'Dramatic Techniques', color: '#00ff88', desc: 'Devices used in drama.' },
                    { id: 'tension', label: 'Tension', color: '#00ff88', parent: 'techniques', desc: 'Building suspense and anticipation.' },
                    { id: 'subtext', label: 'Subtext', color: '#00ff88', parent: 'techniques', desc: 'Meaning beneath the dialogue.' },
                    { id: 'analysis', label: 'Analysing Drama', color: '#8338ec', desc: 'Approach to drama questions.' },
                    { id: 'character', label: 'Character Study', color: '#8338ec', parent: 'analysis', desc: 'Motivation, development, relationships.' },
                    { id: 'themes', label: 'Themes', color: '#8338ec', parent: 'analysis', desc: 'Central ideas explored.' }
                ]
            }
        };

        function initMindMaps() {
            renderMindMap('poetry');
        }

        function renderMindMap(topicId) {
            const data = mindmapData[topicId];
            if (!data) return;
            
            const svg = document.getElementById('mindmapSvg');
            svg.innerHTML = '';
            
            const width = 1000, height = 600;
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
            const centerX = width / 2, centerY = height / 2;
            
            // Get parent nodes (no parent property)
            const parentNodes = data.nodes.filter(n => !n.parent);
            const childNodes = data.nodes.filter(n => n.parent);
            
            // Calculate positions for parent nodes in a circle - more space
            const parentRadius = 200;
            parentNodes.forEach((node, i) => {
                const angle = (i / parentNodes.length) * 2 * Math.PI - Math.PI / 2;
                node.x = centerX + Math.cos(angle) * parentRadius;
                node.y = centerY + Math.sin(angle) * parentRadius;
            });
            
            // Calculate positions for child nodes - spread them out more
            childNodes.forEach(node => {
                const parent = parentNodes.find(p => p.id === node.parent) || childNodes.find(p => p.id === node.parent);
                if (parent) {
                    const siblings = childNodes.filter(n => n.parent === node.parent);
                    const idx = siblings.indexOf(node);
                    const baseAngle = Math.atan2(parent.y - centerY, parent.x - centerX);
                    const spreadAngle = 0.6; // Increased spread
                    const childAngle = baseAngle + (idx - (siblings.length - 1) / 2) * spreadAngle;
                    const childRadius = 100; // Increased distance
                    node.x = parent.x + Math.cos(childAngle) * childRadius;
                    node.y = parent.y + Math.sin(childAngle) * childRadius;
                    
                    // Keep nodes within bounds
                    node.x = Math.max(60, Math.min(width - 60, node.x));
                    node.y = Math.max(50, Math.min(height - 50, node.y));
                }
            });
            
            // Draw curved links from center to parents
            parentNodes.forEach(node => {
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const dx = node.x - centerX;
                const dy = node.y - centerY;
                const ctrl1X = centerX + dx * 0.3;
                const ctrl1Y = centerY + dy * 0.1;
                const ctrl2X = centerX + dx * 0.7;
                const ctrl2Y = centerY + dy * 0.9;
                path.setAttribute('d', `M ${centerX} ${centerY} C ${ctrl1X} ${ctrl1Y}, ${ctrl2X} ${ctrl2Y}, ${node.x} ${node.y}`);
                path.setAttribute('class', 'mindmap-link');
                path.setAttribute('stroke', node.color);
                path.setAttribute('stroke-width', '2.5');
                svg.appendChild(path);
            });
            
            // Draw links from parents to children
            childNodes.forEach(node => {
                const parent = parentNodes.find(p => p.id === node.parent) || childNodes.find(p => p.id === node.parent);
                if (parent) {
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const midX = (parent.x + node.x) / 2;
                    const midY = (parent.y + node.y) / 2;
                    path.setAttribute('d', `M ${parent.x} ${parent.y} Q ${midX} ${midY} ${node.x} ${node.y}`);
                    path.setAttribute('class', 'mindmap-link');
                    path.setAttribute('stroke', node.color);
                    path.setAttribute('stroke-opacity', '0.6');
                    path.setAttribute('stroke-width', '1.5');
                    svg.appendChild(path);
                }
            });
            
            // Draw center node
            const centerGroup = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            centerGroup.setAttribute('class', 'mindmap-node mindmap-center');
            
            const centerCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            centerCircle.setAttribute('cx', centerX);
            centerCircle.setAttribute('cy', centerY);
            centerCircle.setAttribute('r', 55);
            centerCircle.setAttribute('fill', data.center.color);
            centerCircle.setAttribute('stroke', '#fff');
            centerCircle.setAttribute('stroke-width', '3');
            
            const centerText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            centerText.setAttribute('x', centerX);
            centerText.setAttribute('y', centerY);
            centerText.setAttribute('text-anchor', 'middle');
            centerText.setAttribute('dominant-baseline', 'middle');
            centerText.setAttribute('fill', '#fff');
            centerText.setAttribute('font-size', '13px');
            centerText.setAttribute('font-weight', '600');
            centerText.textContent = data.center.label;
            
            centerGroup.appendChild(centerCircle);
            centerGroup.appendChild(centerText);
            svg.appendChild(centerGroup);
            
            // Draw parent nodes first (larger)
            parentNodes.forEach(node => {
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('class', 'mindmap-node');
                group.style.cursor = 'pointer';
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', 42);
                circle.setAttribute('fill', node.color);
                circle.setAttribute('stroke', '#fff');
                circle.setAttribute('stroke-width', '2');
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('font-size', '10px');
                text.setAttribute('fill', '#fff');
                text.setAttribute('font-weight', '500');
                
                // Word wrap for labels
                const words = node.label.split(' ');
                if (words.length > 2 || node.label.length > 12) {
                    const mid = Math.ceil(words.length / 2);
                    const line1 = words.slice(0, mid).join(' ');
                    const line2 = words.slice(mid).join(' ');
                    
                    const tspan1 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan1.setAttribute('x', node.x);
                    tspan1.setAttribute('dy', '-0.5em');
                    tspan1.textContent = line1;
                    
                    const tspan2 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan2.setAttribute('x', node.x);
                    tspan2.setAttribute('dy', '1.2em');
                    tspan2.textContent = line2;
                    
                    text.appendChild(tspan1);
                    text.appendChild(tspan2);
                } else {
                    text.textContent = node.label;
                }
                
                group.appendChild(circle);
                group.appendChild(text);
                group.addEventListener('click', () => showMindmapInfo(node));
                svg.appendChild(group);
            });
            
            // Draw child nodes (smaller)
            childNodes.forEach(node => {
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('class', 'mindmap-node');
                group.style.cursor = 'pointer';
                
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', node.x);
                circle.setAttribute('cy', node.y);
                circle.setAttribute('r', 32);
                circle.setAttribute('fill', 'rgba(10, 14, 20, 0.8)');
                circle.setAttribute('stroke', node.color);
                circle.setAttribute('stroke-width', '2');
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', node.x);
                text.setAttribute('y', node.y);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('dominant-baseline', 'middle');
                text.setAttribute('font-size', '8px');
                text.setAttribute('fill', '#fff');
                
                // Word wrap for labels
                const words = node.label.split(' ');
                if (words.length > 1 && node.label.length > 10) {
                    const mid = Math.ceil(words.length / 2);
                    const line1 = words.slice(0, mid).join(' ');
                    const line2 = words.slice(mid).join(' ');
                    
                    const tspan1 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan1.setAttribute('x', node.x);
                    tspan1.setAttribute('dy', '-0.5em');
                    tspan1.textContent = line1;
                    
                    const tspan2 = document.createElementNS('http://www.w3.org/2000/svg', 'tspan');
                    tspan2.setAttribute('x', node.x);
                    tspan2.setAttribute('dy', '1.1em');
                    tspan2.textContent = line2;
                    
                    text.appendChild(tspan1);
                    text.appendChild(tspan2);
                } else {
                    text.textContent = node.label;
                }
                
                group.appendChild(circle);
                group.appendChild(text);
                group.addEventListener('click', () => showMindmapInfo(node));
                svg.appendChild(group);
            });
            
            // Hide info panel
            document.getElementById('mindmapInfo').style.display = 'none';
        }

        function showMindmapInfo(node) {
            const info = document.getElementById('mindmapInfo');
            document.getElementById('mindmapInfoTitle').textContent = node.label;
            document.getElementById('mindmapInfoDesc').textContent = node.desc;
            info.style.display = 'block';
        }

        // ==================== STATS & PROGRESS ====================
        let userProgress = {};
        
        function loadProgress() {
            userProgress = JSON.parse(localStorage.getItem('englishProgress') || '{}');
            // Update topics array with saved progress
            topics.forEach(topic => {
                if (userProgress[topic.id]) {
                    topic.progress = userProgress[topic.id].progress || 0;
                }
            });
            updateProgressDisplay();
        }
        
        function saveProgress(topicId, progressValue) {
            if (!userProgress[topicId]) userProgress[topicId] = {};
            userProgress[topicId].progress = progressValue;
            userProgress[topicId].lastViewed = Date.now();
            localStorage.setItem('englishProgress', JSON.stringify(userProgress));
            
            // Update topic in array
            const topic = topics.find(t => t.id === topicId);
            if (topic) topic.progress = progressValue;
            
            updateProgressDisplay();
        }
        
        function updateProgressDisplay() {
            const totalProgress = topics.reduce((sum, t) => sum + (t.progress || 0), 0);
            const avgProgress = Math.round(totalProgress / topics.length);
            const topicsStarted = topics.filter(t => t.progress > 0).length;
            
            // Update dashboard progress ring
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (avgProgress / 100) * circumference;
            const progressCircle = document.getElementById('progressCircle');
            if (progressCircle) {
                progressCircle.setAttribute('stroke-dashoffset', offset);
            }
            const progressPercent = document.getElementById('progressPercent');
            if (progressPercent) {
                progressPercent.textContent = avgProgress + '%';
            }
            const topicsCompleted = document.getElementById('topicsCompleted');
            if (topicsCompleted) {
                topicsCompleted.textContent = topicsStarted;
            }
        }
        
        function updateStats() { document.getElementById('streakCount').textContent = streak; document.getElementById('xpCount').textContent = xp; }
        function addXP(amount) { xp += amount; localStorage.setItem('xp', xp); updateStats(); }

        // ==================== EXAM COUNTDOWN ====================
        function initExamCountdown() {
            // LC English typically in June
            const examDate = new Date('2025-06-11'); // Approximate LC date
            const today = new Date();
            const diffTime = examDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            document.getElementById('daysUntilExam').textContent = diffDays > 0 ? diffDays : 'Exam Passed';
            document.getElementById('examDate').textContent = examDate.toLocaleDateString('en-IE', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        // ==================== POMODORO TIMER ====================
        let pomodoroInterval = null;
        let pomodoroTime = 25 * 60;
        let pomodoroRunning = false;
        let isBreak = false;

        function togglePomodoro() {
            if (pomodoroRunning) {
                clearInterval(pomodoroInterval);
                document.getElementById('pomodoroStart').textContent = 'Resume';
            } else {
                pomodoroInterval = setInterval(updatePomodoro, 1000);
                document.getElementById('pomodoroStart').textContent = 'Pause';
            }
            pomodoroRunning = !pomodoroRunning;
        }

        function updatePomodoro() {
            if (pomodoroTime > 0) {
                pomodoroTime--;
                const mins = Math.floor(pomodoroTime / 60);
                const secs = pomodoroTime % 60;
                document.getElementById('pomodoroDisplay').textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            } else {
                clearInterval(pomodoroInterval);
                pomodoroRunning = false;
                if (!isBreak) {
                    isBreak = true;
                    pomodoroTime = 5 * 60;
                    document.getElementById('pomodoroStatus').textContent = '‚òï Break Time!';
                    document.getElementById('pomodoroStart').textContent = 'Start Break';
                    addXP(25);
                } else {
                    isBreak = false;
                    pomodoroTime = 25 * 60;
                    document.getElementById('pomodoroStatus').textContent = 'Focus Time';
                    document.getElementById('pomodoroStart').textContent = 'Start';
                }
                document.getElementById('pomodoroDisplay').textContent = `${Math.floor(pomodoroTime / 60)}:00`;
                if (Notification.permission === 'granted') {
                    new Notification('Pomodoro Complete!', { body: isBreak ? 'Time for a break!' : 'Break over, back to studying!' });
                }
            }
        }

        function resetPomodoro() {
            clearInterval(pomodoroInterval);
            pomodoroRunning = false;
            isBreak = false;
            pomodoroTime = 25 * 60;
            document.getElementById('pomodoroDisplay').textContent = '25:00';
            document.getElementById('pomodoroStatus').textContent = 'Focus Time';
            document.getElementById('pomodoroStart').textContent = 'Start';
        }

        // ==================== DATA TABLES ====================
        const dataTables = {
            examStructure: {
                title: 'LC English Exam Structure',
                headers: ['Paper', 'Section', 'Content', 'Marks', 'Time'],
                data: [
                    ['Paper 1', 'Question A', 'Comprehension (2 texts)', '50', '~60 min'],
                    ['Paper 1', 'Question B', 'Composing (1 essay)', '50', '~60 min'],
                    ['Paper 1', 'Total', '170 marks (scaled to 200)', '100', '2h 50min'],
                    ['Paper 2', 'Single Text', 'Novel or Drama study', '60', '~45 min'],
                    ['Paper 2', 'Comparative Study', 'Compare 3 texts', '70', '~60 min'],
                    ['Paper 2', 'Poetry', 'Prescribed poetry', '70', '~55 min'],
                    ['Paper 2', 'Total', 'Choose Shakespeare OR Unseen Poetry', '200', '3h 20min']
                ],
                note: 'Total marks: Paper 1 (200) + Paper 2 (200) = 400 marks. Both papers are equally weighted.'
            },
            markingSchemes: {
                title: 'Marking Criteria (PCLM)',
                headers: ['Category', 'Description', 'Weight', 'What Examiners Look For'],
                data: [
                    ['P - Purpose', 'Relevance to the task', '30%', 'Answering the question, staying on topic'],
                    ['C - Coherence', 'Organisation and structure', '30%', 'Clear paragraphs, logical flow, linking'],
                    ['L - Language', 'Expression and vocabulary', '30%', 'Varied vocabulary, appropriate register'],
                    ['M - Mechanics', 'Grammar and spelling', '10%', 'Accurate punctuation, spelling, syntax'],
                    ['---', '---', '---', '---'],
                    ['A Grade', 'Excellent across all criteria', '90%+', 'Original ideas, sophisticated expression'],
                    ['B Grade', 'Very good, minor weaknesses', '75-89%', 'Strong analysis, good control'],
                    ['C Grade', 'Good, competent work', '60-74%', 'Adequate engagement, clear expression']
                ],
                note: 'PCLM is applied to all writing tasks. Always address the question (Purpose) first, then structure your response.'
            },
            essayTypes: {
                title: 'Composing - Essay Types (Paper 1 QB)',
                headers: ['Type', 'Features', 'Register', 'Tips'],
                data: [
                    ['Personal Essay', 'Reflective, introspective, uses anecdote', 'First person, intimate', 'Show personal growth/insight'],
                    ['Discursive Essay', 'Explores both sides of an issue', 'Formal, balanced', 'Strong argument with counter-arguments'],
                    ['Narrative', 'Story with plot, characters, setting', 'Varies with story', 'Show don\'t tell, use dialogue'],
                    ['Speech', 'Persuasive, direct address, rhetorical', 'Formal but engaging', 'Use rhetorical questions, repetition'],
                    ['Article', 'Journalistic, headline, subheadings', 'Semi-formal', 'Catchy opening, clear structure'],
                    ['Blog/Diary', 'Personal, dated entries, informal', 'Conversational', 'Voice, personality, reflection'],
                    ['Letter', 'Formal or informal, clear purpose', 'Depends on recipient', 'Appropriate opening/closing']
                ],
                note: 'Read the question carefully - it will specify the type. Marks are awarded for appropriate style and register.'
            },
            poets: {
                title: 'Prescribed Poets (2024-2026)',
                headers: ['Poet', 'Key Themes', 'Style Features', 'Popular Poems'],
                data: [
                    ['W.B. Yeats', 'Irish identity, aging, mythology', 'Symbolism, Irish references', 'Lake Isle, Easter 1916, Sailing to Byzantium'],
                    ['Sylvia Plath', 'Identity, death, relationships', 'Confessional, vivid imagery', 'Mirror, Pheasant, Morning Song'],
                    ['Seamus Heaney', 'Rural Ireland, memory, history', 'Sensory detail, earthy language', 'Digging, Mid-Term Break, Bogland'],
                    ['Elizabeth Bishop', 'Loss, observation, travel', 'Precise description, understatement', 'The Fish, First Death in Nova Scotia'],
                    ['Eavan Boland', 'Women, Irish history, suburbia', 'Personal and political', 'Child of Our Time, The War Horse'],
                    ['Derek Mahon', 'Alienation, decay, observation', 'Detached, philosophical', 'A Disused Shed, Grandfather']
                ],
                note: 'Study at least 6-8 poems per poet. Know themes, techniques, and be able to compare poets.'
            },
            comparative: {
                title: 'Comparative Study - Modes of Comparison',
                headers: ['Mode', 'Focus', 'Key Questions to Ask', 'Linking Words'],
                data: [
                    ['Theme/Issue', 'Shared themes across texts', 'How is [theme] explored? What attitudes?', 'Similarly, In contrast, Both texts'],
                    ['Literary Genre', 'Genre conventions used', 'How do texts use/subvert conventions?', 'While X uses..., Y employs...'],
                    ['General Vision', 'Optimistic/pessimistic outlook', 'Is the worldview hopeful or bleak?', 'The vision in X is..., whereas'],
                    ['---', '---', '---', '---'],
                    ['Key Requirement', 'Compare at minimum 3 texts', 'Novel + Play + Film (typical combo)', 'Links must be constant'],
                    ['Structure Tip', 'P1: Introduce, P2-4: Body, P5: Conclude', 'Each paragraph links all 3 texts', 'Never analyse texts separately']
                ],
                note: 'Always name the mode in your introduction. Compare throughout - never write about texts in isolation.'
            }
        };

        function initDataTables() {
            renderDataTable('examStructure');
            document.querySelectorAll('[data-table]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-table]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    renderDataTable(btn.dataset.table);
                });
            });
        }

        function renderDataTable(tableId) {
            const table = dataTables[tableId];
            let html = `<h3 style="margin-bottom: 1rem; color: var(--accent-cyan);">${table.title}</h3>`;
            html += `<div style="overflow-x: auto;"><table style="width: 100%; border-collapse: collapse;">`;
            html += `<thead><tr>${table.headers.map(h => `<th style="text-align: left; padding: 0.75rem; background: var(--bg-tertiary); border-bottom: 2px solid var(--accent-cyan); font-weight: 600;">${h}</th>`).join('')}</tr></thead>`;
            html += `<tbody>`;
            table.data.forEach((row, i) => {
                html += `<tr style="background: ${i % 2 === 0 ? 'var(--bg-secondary)' : 'transparent'};">`;
                row.forEach(cell => {
                    html += `<td style="padding: 0.6rem 0.75rem; border-bottom: 1px solid var(--glass-border); font-family: 'Space Mono', monospace; font-size: 0.85rem;">${cell}</td>`;
                });
                html += `</tr>`;
            });
            html += `</tbody></table></div>`;
            html += `<div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 212, 255, 0.1); border-left: 3px solid var(--accent-cyan); border-radius: 0 var(--radius-sm) var(--radius-sm) 0; font-size: 0.85rem; color: var(--text-secondary);">üí° ${table.note}</div>`;
            document.getElementById('dataTableContent').innerHTML = html;
        }

        // ==================== GLOSSARY ====================
        const glossaryTerms = [
            { term: 'Metaphor', def: 'A direct comparison between two things without using "like" or "as".', cat: 'poetry' },
            { term: 'Simile', def: 'A comparison using "like" or "as".', cat: 'poetry' },
            { term: 'Personification', def: 'Giving human qualities to non-human things.', cat: 'poetry' },
            { term: 'Alliteration', def: 'Repetition of consonant sounds at the beginning of words.', cat: 'poetry' },
            { term: 'Assonance', def: 'Repetition of vowel sounds within words.', cat: 'poetry' },
            { term: 'Onomatopoeia', def: 'Words that imitate the sounds they describe.', cat: 'poetry' },
            { term: 'Enjambment', def: 'When a sentence continues from one line to the next without punctuation.', cat: 'poetry' },
            { term: 'Caesura', def: 'A pause in the middle of a line of poetry.', cat: 'poetry' },
            { term: 'Volta', def: 'A turn or shift in thought or argument in a poem, especially in a sonnet.', cat: 'poetry' },
            { term: 'Imagery', def: 'Descriptive language that appeals to the senses.', cat: 'poetry' },
            { term: 'Soliloquy', def: 'A speech where a character speaks thoughts aloud, alone on stage.', cat: 'drama' },
            { term: 'Aside', def: 'A remark heard by the audience but not by other characters.', cat: 'drama' },
            { term: 'Dramatic Irony', def: 'When the audience knows something the characters do not.', cat: 'drama' },
            { term: 'Tragic Hero', def: 'A protagonist of high status with a fatal flaw leading to their downfall.', cat: 'drama' },
            { term: 'Hamartia', def: 'The fatal flaw or error in judgement of a tragic hero.', cat: 'drama' },
            { term: 'Catharsis', def: 'The emotional release or purification experienced by the audience.', cat: 'drama' },
            { term: 'Stage Directions', def: 'Instructions in a script about movement, tone, lighting, or setting.', cat: 'drama' },
            { term: 'Subtext', def: 'The underlying meaning beneath the dialogue.', cat: 'drama' },
            { term: 'Narrator', def: 'The voice telling the story.', cat: 'prose' },
            { term: 'Unreliable Narrator', def: 'A narrator whose credibility is compromised or questionable.', cat: 'prose' },
            { term: 'Stream of Consciousness', def: 'A narrative technique presenting a character\'s continuous flow of thoughts.', cat: 'prose' },
            { term: 'Foreshadowing', def: 'Hints or clues about events that will happen later in the story.', cat: 'prose' },
            { term: 'Flashback', def: 'A scene that interrupts the present to show past events.', cat: 'prose' },
            { term: 'Motif', def: 'A recurring element (image, idea, symbol) that develops a theme.', cat: 'prose' },
            { term: 'Characterisation', def: 'The methods used by a writer to develop and reveal characters.', cat: 'prose' },
            { term: 'Pathetic Fallacy', def: 'When nature reflects or mirrors human emotions.', cat: 'prose' },
            { term: 'Ethos', def: 'Persuasion through credibility and ethics of the speaker.', cat: 'rhetoric' },
            { term: 'Pathos', def: 'Persuasion through emotional appeal.', cat: 'rhetoric' },
            { term: 'Logos', def: 'Persuasion through logic and reasoning.', cat: 'rhetoric' },
            { term: 'Rhetorical Question', def: 'A question asked for effect, not expecting an answer.', cat: 'rhetoric' },
            { term: 'Anaphora', def: 'Repetition of a word or phrase at the beginning of successive clauses.', cat: 'rhetoric' },
            { term: 'Hyperbole', def: 'Deliberate exaggeration for emphasis or effect.', cat: 'rhetoric' },
            { term: 'Tricolon', def: 'Three parallel words, phrases, or clauses used together for effect.', cat: 'rhetoric' },
            { term: 'Antithesis', def: 'Contrasting ideas in balanced phrases.', cat: 'rhetoric' },
            { term: 'Tone', def: 'The writer\'s attitude towards the subject or audience.', cat: 'language' },
            { term: 'Register', def: 'The level of formality in language (formal, informal, colloquial).', cat: 'language' },
            { term: 'Diction', def: 'Word choice and vocabulary selection.', cat: 'language' },
            { term: 'Syntax', def: 'Sentence structure and arrangement.', cat: 'language' },
            { term: 'Irony', def: 'When meaning is opposite to what is literally said.', cat: 'language' },
            { term: 'Euphemism', def: 'A mild word substituted for a harsh or unpleasant one.', cat: 'language' },
            { term: 'Connotation', def: 'The implied meaning beyond the literal definition.', cat: 'language' },
            { term: 'PEEL Structure', def: 'Point, Evidence, Explain, Link - a structure for analytical paragraphs.', cat: 'writing' },
            { term: 'Thesis Statement', def: 'A sentence that expresses the main argument of an essay.', cat: 'writing' },
            { term: 'Topic Sentence', def: 'The opening sentence of a paragraph that states the main idea.', cat: 'writing' },
            { term: 'Comparative Mode', def: 'The lens through which texts are compared (Theme, Genre, or Vision).', cat: 'writing' },
            { term: 'Close Reading', def: 'Careful analysis of language, structure, and effect in a text.', cat: 'writing' },
            { term: 'Quotation Integration', def: 'Embedding quotes smoothly into your analysis.', cat: 'writing' }
        ].sort((a, b) => a.term.localeCompare(b.term));

        let currentGlossaryCategory = 'all';

        function initGlossary() {
            renderGlossary(glossaryTerms);
        }

        function renderGlossary(terms) {
            const html = terms.map(t => `
                <div style="padding: 1rem; border-bottom: 1px solid var(--glass-border);">
                    <div style="font-weight: 600; color: var(--accent-cyan); margin-bottom: 0.25rem;">${t.term}</div>
                    <div style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">${t.def}</div>
                    <span style="font-size: 0.7rem; background: var(--bg-tertiary); padding: 0.2rem 0.5rem; border-radius: 10px; color: var(--text-muted); margin-top: 0.5rem; display: inline-block;">${t.cat}</span>
                </div>
            `).join('');
            document.getElementById('glossaryContent').innerHTML = html || '<p style="color: var(--text-muted); text-align: center; padding: 2rem;">No terms found.</p>';
        }

        function filterGlossary(query) {
            const filtered = glossaryTerms.filter(t => 
                (currentGlossaryCategory === 'all' || t.cat === currentGlossaryCategory) &&
                (t.term.toLowerCase().includes(query.toLowerCase()) || t.def.toLowerCase().includes(query.toLowerCase()))
            );
            renderGlossary(filtered);
        }

        function filterGlossaryCategory(cat) {
            currentGlossaryCategory = cat;
            document.querySelectorAll('[data-glossary]').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-glossary="${cat}"]`).classList.add('active');
            filterGlossary(document.getElementById('glossarySearch').value);
        }

        // ==================== EXAM MODE ====================
        let examQuestions = [];
        let examCurrentQ = 0;
        let examAnswers = [];
        let examTimerInterval = null;
        let examTimeRemaining = 0;
        let examStartTime = null;

        function startExamMode() {
            const numQ = parseInt(document.getElementById('examQuestions').value);
            const timeLimit = parseInt(document.getElementById('examTime').value);
            
            // Gather all quiz questions
            examQuestions = Object.values(quizData).flat().sort(() => Math.random() - 0.5).slice(0, numQ);
            examCurrentQ = 0;
            examAnswers = new Array(numQ).fill(null);
            examTimeRemaining = timeLimit * 60;
            examStartTime = Date.now();
            
            document.getElementById('examSetup').style.display = 'none';
            document.getElementById('examInProgress').style.display = 'block';
            document.getElementById('examResults').style.display = 'none';
            
            if (timeLimit > 0) {
                examTimerInterval = setInterval(updateExamTimer, 1000);
            } else {
                document.getElementById('examTimer').textContent = '‚àû';
            }
            
            showExamQuestion();
        }

        function updateExamTimer() {
            if (examTimeRemaining > 0) {
                examTimeRemaining--;
                const mins = Math.floor(examTimeRemaining / 60);
                const secs = examTimeRemaining % 60;
                document.getElementById('examTimer').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                if (examTimeRemaining <= 60) {
                    document.getElementById('examTimer').style.color = 'var(--accent-magenta)';
                }
            } else {
                clearInterval(examTimerInterval);
                finishExam();
            }
        }

        function showExamQuestion() {
            const q = examQuestions[examCurrentQ];
            const total = examQuestions.length;
            
            document.getElementById('examQuestionNum').textContent = `${examCurrentQ + 1} of ${total}`;
            document.getElementById('examAnswered').textContent = `${examAnswers.filter(a => a !== null).length} / ${total}`;
            
            const letters = ['A', 'B', 'C', 'D'];
            document.getElementById('examQuestionContent').innerHTML = `
                <div style="font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem;">${q.q}</div>
                <div class="answers">
                    ${q.options.map((opt, i) => `
                        <div class="answer-option ${examAnswers[examCurrentQ] === i ? 'selected' : ''}" data-index="${i}" onclick="selectExamAnswer(${i})">
                            <span class="answer-letter">${letters[i]}</span>
                            <span>${opt}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('examNextBtn').textContent = examCurrentQ === total - 1 ? 'Finish Exam' : 'Next Question ‚Üí';
        }

        function selectExamAnswer(index) {
            examAnswers[examCurrentQ] = index;
            document.querySelectorAll('#examQuestionContent .answer-option').forEach((opt, i) => {
                opt.classList.toggle('selected', i === index);
            });
            document.getElementById('examAnswered').textContent = `${examAnswers.filter(a => a !== null).length} / ${examQuestions.length}`;
        }

        function nextExamQuestion() {
            if (examCurrentQ < examQuestions.length - 1) {
                examCurrentQ++;
                showExamQuestion();
            } else {
                finishExam();
            }
        }

        function endExamEarly() {
            if (confirm('Are you sure you want to end the exam? Unanswered questions will be marked incorrect.')) {
                finishExam();
            }
        }

        function finishExam() {
            clearInterval(examTimerInterval);
            
            let correct = 0;
            examQuestions.forEach((q, i) => {
                if (examAnswers[i] === q.correct) correct++;
            });
            
            const percent = Math.round((correct / examQuestions.length) * 100);
            const timeSpent = Math.floor((Date.now() - examStartTime) / 1000);
            const mins = Math.floor(timeSpent / 60);
            const secs = timeSpent % 60;
            
            document.getElementById('examInProgress').style.display = 'none';
            document.getElementById('examResults').style.display = 'block';
            
            document.getElementById('examFinalScore').textContent = `${percent}%`;
            document.getElementById('examScoreLabel').textContent = `${correct} out of ${examQuestions.length} correct`;
            document.getElementById('examCorrectCount').textContent = correct;
            document.getElementById('examWrongCount').textContent = examQuestions.length - correct;
            document.getElementById('examTimeSpent').textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
            
            // Calculate grade
            let grade = 'H8';
            if (percent >= 90) grade = 'H1';
            else if (percent >= 80) grade = 'H2';
            else if (percent >= 70) grade = 'H3';
            else if (percent >= 60) grade = 'H4';
            else if (percent >= 50) grade = 'H5';
            else if (percent >= 40) grade = 'H6';
            else if (percent >= 30) grade = 'H7';
            
            document.getElementById('examGrade').innerHTML = `
                <div style="font-size: 0.9rem; opacity: 0.8;">Predicted Grade</div>
                <div style="font-size: 2.5rem; font-weight: 700;">${grade}</div>
            `;
            
            addXP(correct * 5 + (percent >= 70 ? 50 : 0));
        }

        function resetExamMode() {
            document.getElementById('examSetup').style.display = 'block';
            document.getElementById('examResults').style.display = 'none';
            document.getElementById('examTimer').style.color = 'var(--accent-cyan)';
        }

        function reviewExamAnswers() {
            // Show all questions with correct answers highlighted
            alert('Review feature coming soon! For now, retake the exam and note which topics need more practice.');
        }

        // ==================== KEYBOARD ====================
        document.addEventListener('keydown', (e) => {
            if (document.getElementById('flashcards').classList.contains('active')) { if (e.key === ' ' || e.key === 'Enter') { document.getElementById('flashcard').click(); e.preventDefault(); } if (e.key === 'ArrowLeft') document.getElementById('prevCard').click(); if (e.key === 'ArrowRight') document.getElementById('nextCard').click(); }
            if (e.key === 'Escape') document.getElementById('elementModal').classList.remove('active');
        });

        // ==================== PWA SERVICE WORKER ====================
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('EnglishMaster LC: Service Worker registered', reg.scope))
                    .catch(err => console.log('EnglishMaster LC: SW registration failed', err));
            });
        }
    </script>
</body>
</html>